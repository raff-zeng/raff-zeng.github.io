<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="第一章 ROS基础 1.ROS安装 http://wiki.ros.org/cn/noetic/Installation/Ubuntu\nhttps://blog.csdn.net/qq_44339029/article/details/120579608?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-1-120579608-blog-106899359.pc_relevant_baidufeatures_v6&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-1-120579608-blog-106899359.pc_relevant_baidufeatures_v6&amp;utm_relevant_index=2\n2. 安装rosinstall $ sudo apt-get install python-rosinstall\n3.创建catkin工作空间： 1 2 3 4 5 ~$ mkdir -p ~/catkin_ws/src ~$ cd ~/catkin_ws/src ~/catkin_ws/src$ catkin_init_workspace ~/catkin_ws/src$ cd .. ~/catkin_ws$ catkin_make 4.加载源文件setup.bash 1 2 ~/catkin_ws$ source ~/catkin_ws/devel/setup.bash ~/catkin_ws$ echo &#34;source ~/catkin_ws/devel/setup.bash&#34; &gt;&gt; ~/.bashrc 查看工作空间： ~/catkin_ws$ echo $ROS_PACKAGE_PATH\n5.ROS功能包 http://wiki.ros.org/Packages\n命令：\nrospack 用于获取一个功能包的信息\n$ rospack help | less\nroscd 切换ROS目录\n$ roscd turtlesim\n">
<title>ROS机器人开发</title>

<link rel='canonical' href='https://raff-zeng.github.io/post/reading-notes/notes-at-school/ros-robotics-develop/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="ROS机器人开发">
<meta property='og:description' content="第一章 ROS基础 1.ROS安装 http://wiki.ros.org/cn/noetic/Installation/Ubuntu\nhttps://blog.csdn.net/qq_44339029/article/details/120579608?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-1-120579608-blog-106899359.pc_relevant_baidufeatures_v6&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-1-120579608-blog-106899359.pc_relevant_baidufeatures_v6&amp;utm_relevant_index=2\n2. 安装rosinstall $ sudo apt-get install python-rosinstall\n3.创建catkin工作空间： 1 2 3 4 5 ~$ mkdir -p ~/catkin_ws/src ~$ cd ~/catkin_ws/src ~/catkin_ws/src$ catkin_init_workspace ~/catkin_ws/src$ cd .. ~/catkin_ws$ catkin_make 4.加载源文件setup.bash 1 2 ~/catkin_ws$ source ~/catkin_ws/devel/setup.bash ~/catkin_ws$ echo &#34;source ~/catkin_ws/devel/setup.bash&#34; &gt;&gt; ~/.bashrc 查看工作空间： ~/catkin_ws$ echo $ROS_PACKAGE_PATH\n5.ROS功能包 http://wiki.ros.org/Packages\n命令：\nrospack 用于获取一个功能包的信息\n$ rospack help | less\nroscd 切换ROS目录\n$ roscd turtlesim\n">
<meta property='og:url' content='https://raff-zeng.github.io/post/reading-notes/notes-at-school/ros-robotics-develop/'>
<meta property='og:site_name' content=''>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='ros' /><meta property='article:tag' content='robotics' /><meta property='article:published_time' content='2023-01-01T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2023-01-01T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="ROS机器人开发">
<meta name="twitter:description" content="第一章 ROS基础 1.ROS安装 http://wiki.ros.org/cn/noetic/Installation/Ubuntu\nhttps://blog.csdn.net/qq_44339029/article/details/120579608?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-1-120579608-blog-106899359.pc_relevant_baidufeatures_v6&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-1-120579608-blog-106899359.pc_relevant_baidufeatures_v6&amp;utm_relevant_index=2\n2. 安装rosinstall $ sudo apt-get install python-rosinstall\n3.创建catkin工作空间： 1 2 3 4 5 ~$ mkdir -p ~/catkin_ws/src ~$ cd ~/catkin_ws/src ~/catkin_ws/src$ catkin_init_workspace ~/catkin_ws/src$ cd .. ~/catkin_ws$ catkin_make 4.加载源文件setup.bash 1 2 ~/catkin_ws$ source ~/catkin_ws/devel/setup.bash ~/catkin_ws$ echo &#34;source ~/catkin_ws/devel/setup.bash&#34; &gt;&gt; ~/.bashrc 查看工作空间： ~/catkin_ws$ echo $ROS_PACKAGE_PATH\n5.ROS功能包 http://wiki.ros.org/Packages\n命令：\nrospack 用于获取一个功能包的信息\n$ rospack help | less\nroscd 切换ROS目录\n$ roscd turtlesim\n">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu5202140483351697843.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/"></a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/raff-zeng'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/page/archives/' >
                
                
                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/post/tech-blogs/' >
                
                
                
                <span>技术博客</span>
            </a>
        </li>
        
        
        <li >
            <a href='/post/robot-notes/' >
                
                
                
                <span>机器人笔记</span>
            </a>
        </li>
        
        
        <li  class='current' >
            <a href='/post/reading-notes/' >
                
                
                
                <span>读书笔记</span>
            </a>
        </li>
        
        
        <li >
            <a href='/page/about/test-chinese/' >
                
                
                
                <span>关于我</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#1ros安装">1.ROS安装</a></li>
    <li><a href="#2-安装rosinstall">2. 安装rosinstall</a></li>
    <li><a href="#3创建catkin工作空间">3.创建catkin工作空间：</a></li>
    <li><a href="#4加载源文件setupbash">4.加载源文件setup.bash</a></li>
    <li><a href="#5ros功能包">5.ROS功能包</a></li>
    <li><a href="#6ros节点话题消息">6.ros节点、话题、消息</a></li>
    <li><a href="#7ros机器人模拟程序">7.ROS机器人模拟程序</a></li>
    <li><a href="#8控制乌龟运动">8.控制乌龟运动</a></li>
  </ol>

  <ol>
    <li><a href="#1安装rviz">1.安装rviz</a></li>
    <li><a href="#2生成并构建ros功能包">2.生成并构建ROS功能包</a></li>
    <li><a href="#3-构建机器人urdf">3. 构建机器人URDF</a></li>
    <li><a href="#gazebo"><strong>Gazebo</strong></a>
      <ol>
        <li><a href="#1安装gazebo">1.安装Gazebo</a></li>
        <li><a href="#2urdf修改"><strong>2.URDF修改</strong></a></li>
        <li><a href="#3matlab"><strong>3.MATLAB</strong></a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#turtlebot3">Turtlebot3</a>
      <ol>
        <li><a href="#在riviz中启动turtlebot3模拟软件">在riviz中启动turtlebot3模拟软件</a></li>
        <li><a href="#在gazebo中启动turtlebot3模拟软件">在gazebo中启动turtlebot3模拟软件</a></li>
      </ol>
    </li>
    <li><a href="#实际turtlebot3机器人">实际Turtlebot3机器人</a>
      <ol>
        <li><a href="#turtlebot3与远程计算机网络连接">Turtlebot3与远程计算机网络连接</a></li>
        <li><a href="#ssh连接">SSH连接</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#配置3d传感器kinect">配置3D传感器Kinect</a></li>
    <li><a href="#独立模式下测试3d传感器">独立模式下测试3D传感器</a></li>
    <li><a href="#运行ros节点进行可视化">运行ROS节点进行可视化</a>
      <ol>
        <li><a href="#使用image-viewer可视化数据">使用Image Viewer可视化数据</a></li>
        <li><a href="#使用riz可视化数据">使用Riz可视化数据</a></li>
      </ol>
    </li>
    <li><a href="#turtlebot机器人导航">Turtlebot机器人导航</a></li>
    <li><a href="#turtlebot机器人自主导航">Turtlebot机器人自主导航</a>
      <ol>
        <li><a href="#无人控制模式下驱动">无人控制模式下驱动</a></li>
        <li><a href="#导航至目标点">导航至目标点</a></li>
        <li><a href="#基于python脚本与地图实现航路点导航">基于python脚本与地图实现航路点导航</a></li>
        <li><a href="#turtlebot3机器人的slam">Turtlebot3机器人的SLAM</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#1利用xacro建立一个关节式机器人手臂urdf">1.利用Xacro建立一个关节式机器人手臂URDF</a></li>
    <li><a href="#2扩展xacro"><strong>2.扩展Xacro</strong></a></li>
    <li><a href="#3添加颜色"><strong>3.添加颜色</strong></a></li>
    <li><a href="#4惯性的宏使用"><strong>4.惯性的宏使用</strong></a></li>
    <li><a href="#5添加抓手"><strong>5.添加抓手</strong></a></li>
    <li><a href="#6在gazebo中控制关节式机器人手臂">6.在Gazebo中控制关节式机器人手臂</a></li>
    <li><a href="#7给xacro添加控制组件">7.给Xacro添加控制组件</a>
      <ol>
        <li><a href="#1定义关节的传动元素"><strong>（1）定义关节的传动元素</strong></a></li>
        <li><a href="#2添加gazebo的ros控制插件"><strong>（2）添加Gazebo的ROS控制插件</strong></a></li>
        <li><a href="#3生成yaml配置文件"><strong>（3）生成YAML配置文件</strong></a></li>
        <li><a href="#4创建控制启动文件">（4）创建控制启动文件</a></li>
      </ol>
    </li>
    <li><a href="#采用ros命令行控制机器人手臂">采用ROS命令行控制机器人手臂</a></li>
    <li><a href="#采用rqt控制机器人手臂">采用rqt控制机器人手臂</a></li>
  </ol>

  <ol>
    <li><a href="#下载baxter软件">下载Baxter软件</a>
      <ol>
        <li><a href="#安装baxter-sdk软件">安装Baxter SDK软件</a></li>
        <li><a href="#安装baxter模拟器">安装Baxter模拟器</a></li>
        <li><a href="#配置baxter-shell">配置Baxter shell</a></li>
        <li><a href="#安装moveit-">安装MoveIt ！</a></li>
      </ol>
    </li>
    <li><a href="#在gazebo中启动baxter模拟器">在Gazebo中启动Baxter模拟器</a></li>
    <li><a href="#baxter手臂与正向运动">Baxter手臂与正向运动</a>
      <ol>
        <li><a href="#关节与关节状态发布器">关节与关节状态发布器</a></li>
        <li><a href="#理解tf">理解tf</a></li>
        <li><a href="#直接指定关节组件角度">直接指定关节组件角度</a></li>
        <li><a href="#查看机器人元素的tf树">查看机器人元素的tf树</a></li>
      </ol>
    </li>
    <li><a href="#moveit-简介">MoveIt 简介</a>
      <ol>
        <li><a href="#控制真实的baxter机器人">控制真实的Baxter机器人</a></li>
        <li><a href="#反向运动">反向运动</a></li>
        <li><a href="#使用状态机实现ymca">使用状态机实现YMCA</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/reading-notes/" >
                Reading-Notes
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/post/reading-notes/notes-at-school/ros-robotics-develop/">ROS机器人开发</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 01, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 40 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="第一章-ros基础">第一章 ROS基础
</h1><h2 id="1ros安装">1.ROS安装
</h2><p><a class="link" href="http://wiki.ros.org/cn/noetic/Installation/Ubuntu"  target="_blank" rel="noopener"
    >http://wiki.ros.org/cn/noetic/Installation/Ubuntu</a></p>
<p><a class="link" href="https://blog.csdn.net/qq_44339029/article/details/120579608?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-1-120579608-blog-106899359.pc_relevant_baidufeatures_v6&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-1-120579608-blog-106899359.pc_relevant_baidufeatures_v6&amp;utm_relevant_index=2"  target="_blank" rel="noopener"
    >https://blog.csdn.net/qq_44339029/article/details/120579608?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-1-120579608-blog-106899359.pc_relevant_baidufeatures_v6&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-1-120579608-blog-106899359.pc_relevant_baidufeatures_v6&amp;utm_relevant_index=2</a></p>
<h2 id="2-安装rosinstall">2. 安装rosinstall
</h2><p><code>$ sudo apt-get install python-rosinstall</code></p>
<h2 id="3创建catkin工作空间">3.创建catkin工作空间：
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">~$ mkdir -p ~/catkin_ws/src
</span></span><span class="line"><span class="cl">~$ cd ~/catkin_ws/src
</span></span><span class="line"><span class="cl">~/catkin_ws/src$ catkin_init_workspace 
</span></span><span class="line"><span class="cl">~/catkin_ws/src$ cd ..
</span></span><span class="line"><span class="cl">~/catkin_ws$ catkin_make
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="4加载源文件setupbash">4.加载源文件setup.bash
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">~/catkin_ws$ source ~/catkin_ws/devel/setup.bash 
</span></span><span class="line"><span class="cl">~/catkin_ws$ echo &#34;source ~/catkin_ws/devel/setup.bash&#34; &gt;&gt; ~/.bashrc
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看工作空间：           	<code>~/catkin_ws$ echo $ROS_PACKAGE_PATH</code></p>
<h2 id="5ros功能包">5.ROS功能包
</h2><p><a class="link" href="http://wiki.ros.org/Packages"  target="_blank" rel="noopener"
    >http://wiki.ros.org/Packages</a></p>
<p>命令：</p>
<ul>
<li>
<p>rospack  用于获取一个功能包的信息</p>
<p><code>$ rospack help | less</code></p>
</li>
<li>
<p>roscd 切换ROS目录</p>
<p><code>$ roscd turtlesim</code></p>
</li>
<li>
<p>rosls 列出一个功能包目录下的目录与文件清单</p>
<p><code>$ rosls turtlesim</code></p>
</li>
<li>
<p>rospack find 返回指定名称的功能包的路径</p>
<p><code>$ rospack find turtlesim</code></p>
</li>
</ul>
<h2 id="6ros节点话题消息">6.ros节点、话题、消息
</h2><ul>
<li>
<p>rosnode list 列出运行的节点</p>
</li>
<li>
<p>rostopic list 列出与运行中的节点相关的话题</p>
</li>
</ul>
<p>使用帮助 <code>rosnode -h</code></p>
<p>​				<code>rosnode list -h</code></p>
<h2 id="7ros机器人模拟程序">7.ROS机器人模拟程序
</h2><ul>
<li>rosrun  在功能包里找到并启动所需要的节点</li>
<li>rosmsg  显示相关消息的信息</li>
<li>rosservice 显示节点的运行时间，并且在请求/响应模式下在节点间传递数据</li>
<li>rosparam  获取或者设置节点参数值</li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>启动ROS节点管理器</th>
          <th>roscore</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>启动节点</td>
          <td>rosrun turtlesim turtlesim_node</td>
      </tr>
      <tr>
          <td>列出活动节点</td>
          <td>rosnode list</td>
      </tr>
      <tr>
          <td>查看/turtlesim节点的发布话题、订阅服务和服务相关内容</td>
          <td>rosnode info /turtlesim</td>
      </tr>
      <tr>
          <td>查看/turtlesim节点的话题</td>
          <td>rostopic list</td>
      </tr>
      <tr>
          <td>查看话题的话题类型</td>
          <td>rostopic type /turtle1/color_sensor</td>
      </tr>
      <tr>
          <td>查看消息类型</td>
          <td>rosmsg list</td>
      </tr>
      <tr>
          <td>查看ROS消息类型的具体内容</td>
          <td>rosmsg show turtlesim/Color</td>
      </tr>
      <tr>
          <td>查看乌龟背景颜色的数值</td>
          <td>rostopic echo /turtle1/color_sensor</td>
      </tr>
  </tbody>
</table></div>
<h2 id="8控制乌龟运动">8.控制乌龟运动
</h2><ul>
<li>启动节点管理器，并启动turtlesim_node</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ roscore
</span></span><span class="line"><span class="cl">$ rosrun turtlesim turtlesim_node
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>turtlesim_node订阅/turtle1/cmd_vel话题，可以通过/turtle1/cmd_vel发送消息来控制乌龟运动</p>
</li>
<li>
<p>确定该话题的消息类型</p>
<p><code>$ rostopic type /turtle1/cmd_vel</code></p>
<p>消息类型为Twist，来自geometry_msgs功能包  	geometry_msgs/Twist</p>
</li>
<li>
<p>控制乌龟做圆周运动</p>
<p><code>$ rostopic pub /turtle1/cmd_vel geometry_msgs/Twist -r 1 -- '[2.0,0.0,0.0]' '[0.0 0.0 1.8]'</code></p>
<p>控制乌龟以2m/s的线速度和1.8弧度/s的角速度做圆周运动</p>
</li>
</ul>
<p>数值参量参考 <a class="link" href="http://wiki.ros.org/ROS/YAMLCommandLine"  target="_blank" rel="noopener"
    >http://wiki.ros.org/ROS/YAMLCommandLine</a></p>
<ul>
<li>
<p>键盘控制<code>rosrun turtlesim turtle_teleop_key</code></p>
</li>
<li>
<p>turtlesim的参数服务器</p>
<p><code>rosparam list</code>   列出/turtlesim节点的参数列表</p>
<p><code>rosparam get</code> / 获得整个参数服务器上所有参数的数值</p>
</li>
<li>
<p>将乌龟背景的颜色改为红色 rosparam set background_b 0</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ rosparam set background_g 0
</span></span><span class="line"><span class="cl">$ rosparam set background_r 0
</span></span><span class="line"><span class="cl">$ rosservice call /clear
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>控制乌龟移动的ROS服务</li>
</ul>
<p>通过/turtle1/pose 话题获得乌龟的位置信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ rostopic type /turtle1/pose
</span></span><span class="line"><span class="cl">$ rosmsg show turtlesim/Pose
</span></span></code></pre></td></tr></table>
</div>
</div><p>获得乌龟的位置坐标、方位角度和速度参数</p>
<p>​	<code>$ rostopic echo /turtle1/pose</code></p>
<p>使用rossevice远程控制端口移动乌龟</p>
<p>​	<code>$ rosservice call /turtle1/teleport_absolute 1 1 0</code></p>
<p>更多命令 <a class="link" href="http://wiki.ros.org/ROS/CommandLineTools"  target="_blank" rel="noopener"
    >http://wiki.ros.org/ROS/CommandLineTools</a></p>
<h1 id="第二章-构建模拟两轮ros机器人"><strong>第二章 构建模拟两轮ROS机器人</strong>
</h1><p>rviz是ROS可视化的缩写，查看模拟的机器人模型、来自机器人传感器的传感器日志和重放已记录的传感器信息</p>
<h2 id="1安装rviz">1.安装rviz
</h2><p><a class="link" href="http://wiki.ros.org/rviz/Tro-ubleshooting"  target="_blank" rel="noopener"
    >http://wiki.ros.org/rviz/Tro-ubleshooting</a></p>
<p>ROS论坛的问题页面http://answers.ros.org/questions/</p>
<ul>
<li>检查是否安装</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">~$ roscore
</span></span><span class="line"><span class="cl">~$ rosrun rviz rviz
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装<code>$ sudo apt-get install ros-kinetic-rviz</code></p>
<p>用户指南http://wiki.ros.org/rviz/UserGuide</p>
<h2 id="2生成并构建ros功能包">2.生成并构建ROS功能包
</h2><p>第一章中的创建catkin工作空间：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">~$ mkdir -p ~/catkin_ws/src
</span></span><span class="line"><span class="cl">~$ cd ~/catkin_ws/src
</span></span><span class="line"><span class="cl">~/catkin_ws/src$ catkin_init_workspace 
</span></span><span class="line"><span class="cl">~/catkin_ws/src$ cd ..
</span></span><span class="line"><span class="cl">~/catkin_ws$ catkin_make
</span></span><span class="line"><span class="cl">~/catkin_ws$ source ~/catkin_ws/devel/setup.bash 
</span></span><span class="line"><span class="cl">~/catkin_ws$ echo &#34;source ~/catkin_ws/src:opt/ros/noetic/share&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">~/catkin_ws$ echo $ROS_PACKAGE_PATH
</span></span><span class="line"><span class="cl">/home/zrf/catkin_ws/src:/opt/ros/noetic/share
</span></span></code></pre></td></tr></table>
</div>
</div><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>切换到catkin工作空间</th>
          <th>~/catkin_ws$ cd src/</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>生成ROS功能包ros_robotics</td>
          <td>~/catkin_ws/src$ catkin_create_pkg ros_robotics</td>
      </tr>
      <tr>
          <td></td>
          <td>~/catkin_ws/src$ cd ..</td>
      </tr>
      <tr>
          <td></td>
          <td>~/catkin_ws$ catkin_make</td>
      </tr>
  </tbody>
</table></div>
<p>例    <code>catkin_create_pkg &lt;package_name&gt; [depend1] [depeng2]</code></p>
<h2 id="3-构建机器人urdf">3. 构建机器人URDF
</h2><p>URDF是一种特殊定义的XML格式的文件，专门用来对机器人组建级别进行抽象的模型描述，Xacro是XML宏命令语言，能够帮助用户减少文件中的重复信息。</p>
<p>在ros_robotics功能包下生成/urdf目录</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">~/catkin_ws$ cd src/
</span></span><span class="line"><span class="cl">~/catkin_ws/src$ cd ros_robotics/
</span></span><span class="line"><span class="cl">~/catkin_ws/src/ros_robotics$ mkdir urdf
</span></span><span class="line"><span class="cl">~/catkin_ws/src/ros_robotics$ cd urdf/
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>描述机器人模型，两个基本的URDF组件定义的一个树状结构。</p>
<p>​	link组件描述了刚体的物理学属性（维度、初始位置、颜色等）</p>
<p>​	joint组件描述了连接的运动学以及动态属性（连接的连接杆、关节类型、旋转轴、摩擦力和阻尼的合力等）</p>
</li>
</ul>
<p><strong>~/catkin_ws/src/ros_robotics/urdf/dd_robotic.urdf:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#39;1.0&#39;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;robot</span> <span class="na">name=</span><span class="s">&#34;dd_robot&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Base Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;base_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;0.5 0.5 0.25&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/robot&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>包含一个link组件，该组件的可视化外形是长宽高为0.5m，0.5m，0.25m的矩形盒子，盒子中心位于初始原点（0，0，0）处，并且在滚转（pitch）、俯仰（pitch）、偏航（yaw）三个轴向上均不存在旋转。连接杆组件命名为base_link。</p>
<ul>
<li>roslaunch:ROS提供的一个启动工具。简化启动多个ROS节点，简化ROS参数服务器进行参数设置</li>
</ul>
<p><strong>~/catkin_ws/src/ros_robotics/launch/ddrobot_rviz.launch:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#39;1.0&#39;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;launch&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="c">&lt;!-- values passed by command line input --&gt;</span>     
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;model&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;gui&#34;</span> <span class="na">default=</span><span class="s">&#34;False&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c">&lt;!-- set these parameters on Parameter Server --&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&#34;robot_description&#34;</span> <span class="na">textfile=</span><span class="s">&#34;$(find ros_robotics)/urdf/$(arg model)&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&#34;use_gui&#34;</span> <span class="na">value=</span><span class="s">&#34;$(arg gui)&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c">&lt;!-- Start 3 nodes: joint_state_publisher, robot_state_publisher and rviz --&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&#34;joint_state_publisher&#34;</span> <span class="na">pkg=</span><span class="s">&#34;joint_state_publisher&#34;</span> <span class="na">type=</span><span class="s">&#34;joint_state_publisher&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&#34;robot_state_publisher&#34;</span> <span class="na">pkg=</span><span class="s">&#34;robot_state_publisher&#34;</span> <span class="na">type=</span><span class="s">&#34;state_publisher&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&#34;rviz&#34;</span> <span class="na">pkg=</span><span class="s">&#34;rviz&#34;</span> <span class="na">type=</span><span class="s">&#34;rviz&#34;</span> <span class="na">args=</span><span class="s">&#34;-d $(find ros_robotics)/urdf.rviz&#34;</span> <span class="na">required=</span><span class="s">&#34;true&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="c">&lt;!-- (required = &#34;true&#34;) if rviz dies, entire roslaunch will be killed --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/launch&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>在Rviz中查看机器人模型：</strong></p>
<p>​		(1) 命令行中设置的模型加载到参数服务器</p>
<p>​		(2) 启动发布了JointState和转换的节点</p>
<p>​		(3) 启动使用urdf.rviz文件配置的Rviz</p>
<p><code>$ roslaunch ros_robotics ddrobot_rviz.launch model:=dd_robot.urdf</code></p>
<p>例   <code>roslaunch &lt;package_name&gt; &lt;file.launch&gt;</code></p>
<ul>
<li>
<p>机器人描述：robot_description是URDF文件中存储的ROS参数的名称，文件存储于参数服务器中。连接杆组件和关节组件的描述以及两者的连接方式也存储于机器人描述中。</p>
</li>
<li>
<p>添加轮子、添加小脚轮、添加颜色、添加碰撞属性、添加物理学属性。</p>
</li>
</ul>
<p><strong>~/catkin_ws/src/ros_robotics/urdf/dd_robotic6.urdf:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#39;1.0&#39;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;robot</span> <span class="na">name=</span><span class="s">&#34;dd_robot&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Base Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;base_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;0.5 0.5 0.25&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;blue&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">&#34;0 0.5 1 1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Base collision, mass and inertia --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;0.5 0.5 0.25&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;inertial&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&#34;5&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;inertia</span> <span class="na">ixx=</span><span class="s">&#34;0.13&#34;</span> <span class="na">ixy=</span><span class="s">&#34;0.0&#34;</span> <span class="na">ixz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">iyy=</span><span class="s">&#34;0.21&#34;</span> <span class="na">iyz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">izz=</span><span class="s">&#34;0.13&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/inertial&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Caster --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual</span> <span class="na">name=</span><span class="s">&#34;caster&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0.2 0 -0.125&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;sphere</span> <span class="na">radius=</span><span class="s">&#34;0.05&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Caster collision, mass and inertia --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0.2 0 -0.125&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;sphere</span> <span class="na">radius=</span><span class="s">&#34;0.05&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;inertial&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&#34;0.5&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;inertia</span> <span class="na">ixx=</span><span class="s">&#34;0.0001&#34;</span> <span class="na">ixy=</span><span class="s">&#34;0.0&#34;</span> <span class="na">ixz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">iyy=</span><span class="s">&#34;0.0001&#34;</span> <span class="na">iyz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">izz=</span><span class="s">&#34;0.0001&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/inertial&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Right Wheel --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;right_wheel&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;1.570795 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">&#34;0.1&#34;</span> <span class="na">radius=</span><span class="s">&#34;0.2&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;darkgray&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">&#34;.2 .2 .2 1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Right Wheel collision, mass and inertia --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;1.570795 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">&#34;0.1&#34;</span> <span class="na">radius=</span><span class="s">&#34;0.2&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;inertial&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&#34;0.5&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;inertia</span> <span class="na">ixx=</span><span class="s">&#34;0.01&#34;</span> <span class="na">ixy=</span><span class="s">&#34;0.0&#34;</span> <span class="na">ixz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">iyy=</span><span class="s">&#34;0.005&#34;</span> <span class="na">iyz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">izz=</span><span class="s">&#34;0.005&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/inertial&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Right Wheel joint --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;joint_right_wheel&#34;</span> <span class="na">type=</span><span class="s">&#34;continuous&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;base_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;right_wheel&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 -0.30 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="nt">/&gt;</span> 
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">&#34;0 1 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Left Wheel --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;left_wheel&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;1.570795 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">&#34;0.1&#34;</span> <span class="na">radius=</span><span class="s">&#34;0.2&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;darkgray&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">&#34;.2 .2 .2 1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Left Wheel collision, mass and inertia --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;1.570795 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">&#34;0.1&#34;</span> <span class="na">radius=</span><span class="s">&#34;0.2&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;inertial&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&#34;0.5&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;inertia</span> <span class="na">ixx=</span><span class="s">&#34;0.01&#34;</span> <span class="na">ixy=</span><span class="s">&#34;0.0&#34;</span> <span class="na">ixz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">iyy=</span><span class="s">&#34;0.005&#34;</span> <span class="na">iyz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">izz=</span><span class="s">&#34;0.005&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/inertial&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Left Wheel joint --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;joint_left_wheel&#34;</span> <span class="na">type=</span><span class="s">&#34;continuous&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;base_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;left_wheel&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0.30 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="nt">/&gt;</span> 
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">&#34;0 1 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/robot&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>$ roslaunch ros_robotics ddrobot_rviz.launch model:=dd_robot6.urdf</code></p>
<p><strong>移动轮子（启动GUI接口）</strong></p>
<p><code>$ roslaunch ros_robotics ddrobot_rviz.launch model:=dd_robot6.urdf gui:=True</code></p>
<p><strong>tf与robot_state_publisher：</strong></p>
<p>节点robot_state_publisher订阅了JointState消息，并将机器人状态消息发布给tf坐标转换库，tf坐标转换库维护着系统中每个元素的坐标系随时间变化的关系。节点robot_state_publisher接收机器人的关节组件角度作为输入，计算出机器人连接杆组件的3D位姿，并将该位姿结果发布出去。</p>
<p>物理学属性参考http://en.wikipedia.org/wiki/List_of_moments_of_inertia</p>
<p><strong>URDF工具：</strong></p>
<ul>
<li>
<p>安装工具  <code>$ sudo apt-get install liburdfdom-tools</code></p>
</li>
<li>
<p>检查URDF文件的语法是否正确check_urdf:</p>
</li>
</ul>
<p><code>~/catkin_ws/src/ros_robotics/urdf$ check_urdf dd_robot6.urdf</code></p>
<ul>
<li>
<p>生成URDF文件对应的graphviz图表以及一个.pdf格式的图表文件urdf_to_graphiz:
<code>~/catkin_ws/src/ros_robotics/urdf$ urdf_to_graphiz dd_robot6.urdf</code></p>
</li>
<li>
<p>打开.pdf文件 	<code>$ evince dd_robot.pdf</code></p>
</li>
</ul>
<h2 id="gazebo"><strong>Gazebo</strong>
</h2><p>免费的开源机器人模拟环境</p>
<h3 id="1安装gazebo">1.安装Gazebo
</h3><p><a class="link" href="http://answers.gazebosim.org/questions/"  target="_blank" rel="noopener"
    >http://answers.gazebosim.org/questions/</a></p>
<p>ROS论坛的问题页面http://answers.ros.org/questions/</p>
<p>安装指南http://gazebosim.org/tutorials?cat=install</p>
<p>用户手册http://gazebosim.org/tutorials</p>
<p>urdf用户手册（连接杆组件和关节组件相关元素、属性的列表清单）https://classic.gazebosim.org/tutorials?tut=ros_urdf</p>
<p><strong>检查是否安装</strong></p>
<p><code>$ gazebo</code></p>
<p><strong>终止Gazebo</strong>  <code>$ rosnode list</code></p>
<p>​       <code>$ rosnode kill -a</code></p>
<p><strong>使用roslaunch 启动Gazebo</strong> <code>$ roslaunch gazebo_ros empty_world.launch</code></p>
<h3 id="2urdf修改"><strong>2.URDF修改</strong>
</h3><p>Gazebo支持的机器人模型文件格式为SDF,通过修改，gazebo能够自动地将URDF代码转换为SDF格式的机器人描述。</p>
<ol>
<li>
<p>添加gazebo标签</p>
<p>&lt;gazebo&gt;标签必须要添加到URDF文件中。若&lt;gazebo&gt;标签没有和reference=“”属性一起使用的话，则意味着对应的&lt;gazebo&gt;元素将应用到整个机器人模型之中。</p>
</li>
<li>
<p>在gazebo中指定颜色</p>
<p>在Rviz中指定颜色的方法在gazebo中不适用，需要为每一个连接杆组件指定一个gazebo&lt;material&gt;标签。</p>
</li>
<li>
<p>gazebo中的&lt;visual&gt;和&lt;collision&gt;属性描述</p>
</li>
</ol>
<p><strong>~/catkin_ws/src/ros_robotics/urdf/dd_robotic.gezebo:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#39;1.0&#39;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;robot</span> <span class="na">name=</span><span class="s">&#34;dd_robot&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Base Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;base_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;0.5 0.5 0.25&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Base collision, mass and inertia --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;0.5 0.5 0.25&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;inertial&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&#34;5&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;inertia</span> <span class="na">ixx=</span><span class="s">&#34;0.13&#34;</span> <span class="na">ixy=</span><span class="s">&#34;0.0&#34;</span> <span class="na">ixz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">iyy=</span><span class="s">&#34;0.21&#34;</span> <span class="na">iyz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">izz=</span><span class="s">&#34;0.13&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/inertial&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Caster --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual</span> <span class="na">name=</span><span class="s">&#34;caster&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0.2 0 -0.125&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;sphere</span> <span class="na">radius=</span><span class="s">&#34;0.05&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Caster collision, mass and inertia --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0.2 0 -0.125&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;sphere</span> <span class="na">radius=</span><span class="s">&#34;0.05&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;inertial&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&#34;0.5&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;inertia</span> <span class="na">ixx=</span><span class="s">&#34;0.0001&#34;</span> <span class="na">ixy=</span><span class="s">&#34;0.0&#34;</span> <span class="na">ixz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">iyy=</span><span class="s">&#34;0.0001&#34;</span> <span class="na">iyz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">izz=</span><span class="s">&#34;0.0001&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/inertial&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;gazebo</span> <span class="na">reference=</span><span class="s">&#34;base_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;material&gt;</span>Gazebo/Blue<span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;pose&gt;</span>0 0 3 0 0 0<span class="nt">&lt;/pose&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/gazebo&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Right Wheel --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;right_wheel&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;1.570795 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">&#34;0.1&#34;</span> <span class="na">radius=</span><span class="s">&#34;0.2&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Right Wheel collision, mass and inertia --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;1.570795 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">&#34;0.1&#34;</span> <span class="na">radius=</span><span class="s">&#34;0.2&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;inertial&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&#34;0.5&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;inertia</span> <span class="na">ixx=</span><span class="s">&#34;0.01&#34;</span> <span class="na">ixy=</span><span class="s">&#34;0.0&#34;</span> <span class="na">ixz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">iyy=</span><span class="s">&#34;0.005&#34;</span> <span class="na">iyz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">izz=</span><span class="s">&#34;0.005&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/inertial&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;gazebo</span> <span class="na">reference=</span><span class="s">&#34;right_wheel&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;material&gt;</span>Gazebo/Black<span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/gazebo&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Right Wheel joint --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;joint_right_wheel&#34;</span> <span class="na">type=</span><span class="s">&#34;continuous&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;base_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;right_wheel&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 -0.30 0.025&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="nt">/&gt;</span> 
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">&#34;0 1 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Left Wheel --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;left_wheel&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;1.570795 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">&#34;0.1&#34;</span> <span class="na">radius=</span><span class="s">&#34;0.2&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Left Wheel collision, mass and inertia --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">rpy=</span><span class="s">&#34;1.570795 0 0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">&#34;0.1&#34;</span> <span class="na">radius=</span><span class="s">&#34;0.2&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;inertial&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&#34;0.5&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;inertia</span> <span class="na">ixx=</span><span class="s">&#34;0.01&#34;</span> <span class="na">ixy=</span><span class="s">&#34;0.0&#34;</span> <span class="na">ixz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">iyy=</span><span class="s">&#34;0.005&#34;</span> <span class="na">iyz=</span><span class="s">&#34;0.0&#34;</span> <span class="na">izz=</span><span class="s">&#34;0.005&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/inertial&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;gazebo</span> <span class="na">reference=</span><span class="s">&#34;left_wheel&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;material&gt;</span>Gazebo/Black<span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/gazebo&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Left Wheel joint --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;joint_left_wheel&#34;</span> <span class="na">type=</span><span class="s">&#34;continuous&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;base_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;left_wheel&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0.30 0.025&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="nt">/&gt;</span> 
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">&#34;0 1 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/robot&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>gazebo模型验证：</strong><code>$ gz sdf -p dd_robot.gazebo</code></p>
<p>或 <code>$ gzsdf -p $(rospack find ros_robotics)/urdf/dd_robot.gazebo</code></p>
<p><strong>~/catkin_ws/src/ros_robotics/launch/ddrobot_gezebo.launch:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;launch&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- We resume the logic in gazebo_ros package empty_world.launch, --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- changing only the name of the world to be launched --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">&#34;$(find gazebo_ros)/launch/empty_world.launch&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;world_name&#34;</span> <span class="na">value=</span><span class="s">&#34;$(find ros_robotics)/worlds/ddrobot.world&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;paused&#34;</span> <span class="na">default=</span><span class="s">&#34;false&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;use_sim_time&#34;</span> <span class="na">default=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;gui&#34;</span> <span class="na">default=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;headless&#34;</span> <span class="na">default=</span><span class="s">&#34;false&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;debug&#34;</span> <span class="na">default=</span><span class="s">&#34;false&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/include&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Spawn dd_robot into Gazebo --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&#34;spawn_urdf&#34;</span> <span class="na">pkg=</span><span class="s">&#34;gazebo_ros&#34;</span> <span class="na">type=</span><span class="s">&#34;spawn_model&#34;</span> <span class="na">output=</span><span class="s">&#34;screen&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="na">args=</span><span class="s">&#34;-file $(find ros_robotics)/urdf/dd_robot.gazebo -urdf -model ddrobot&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/launch&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>由gazebo_ros功能包中的empty_world.launch修改而来，改变了world_name参数，变为了ddrobot.world。</p>
<p>基于URDF的dd_robot机器人模型使用来自gazebo_ros ROS节点的spawn_model服务启动于Gazebo中，若想要复用或者分享上述代码，建议在自己的ros_robotics功能包的package.xml文件中添加相应的依赖：
<code>&lt;exec_depend&gt;gazebo_ros&lt;/exec_depend&gt;</code></p>
<ul>
<li>ddrobot.world环境模型文件包含一个地平面模型和两个圆锥形的建筑模型</li>
</ul>
<p><strong>~/catkin_ws/src/ros_robotics/world/ddrobot.world:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; ?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;sdf</span> <span class="na">version=</span><span class="s">&#34;1.4&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;world</span> <span class="na">name=</span><span class="s">&#34;default&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;include&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;uri&gt;</span>model://ground_plane<span class="nt">&lt;/uri&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/include&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;include&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;uri&gt;</span>model://sun<span class="nt">&lt;/uri&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/include&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;include&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;uri&gt;</span>model://construction_cone<span class="nt">&lt;/uri&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;name&gt;</span>construction_cone<span class="nt">&lt;/name&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;pose&gt;</span>-3.0 0 0 0 0 0<span class="nt">&lt;/pose&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/include&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;include&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;uri&gt;</span>model://construction_cone<span class="nt">&lt;/uri&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;name&gt;</span>construction_cone<span class="nt">&lt;/name&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;pose&gt;</span>3.0 0 0 0 0 0<span class="nt">&lt;/pose&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/include&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/world&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/sdf&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在gazebo中启动机器人模型ddrobot 	<code>$ roslaunch ros_robotics ddrobot_gazebo.launch</code></p>
<ul>
<li>SDF手册	http://sdformat.org/spec</li>
</ul>
<h3 id="3matlab"><strong>3.MATLAB</strong>
</h3><p>机器人系统工具箱的ROS支持http://www.mathworks.com/hardware-support/robot-operating-system.html</p>
<p>示例http://www.mathworks.com/help/robotics/examples/get-started-with-ros.html</p>
<h1 id="第三章-turtlebot机器人操控">第三章 TurtleBot机器人操控
</h1><p>机器人运动控制相关http://kobuki.yujinrobot.com/about2/</p>
<p>TurtleBot维基百科https://wiki.ros.org/Robots/TurtleBot</p>
<p>TurtleBot相关内容参考手册http://learn.turtlebot.com/</p>
<p><strong>ROS网络连接</strong><a class="link" href="https://wiki.ros.org/ROS/NetworkSetup"  target="_blank" rel="noopener"
    >https://wiki.ros.org/ROS/NetworkSetup</a></p>
<p>​						https://wiki.ros.org/ROS/Tutorials/MultipleMachines</p>
<p>ROS_MASTER_URI、ROS_IP和ROS_HOSTNAME变量的相关描述https://wiki.ros.org/ROS/EnvironmentVariables</p>
<p><strong>Python脚本语言</strong>   ROS客户端库 <a class="link" href="http://wiki.ros.org/rospy"  target="_blank" rel="noopener"
    >http://wiki.ros.org/rospy</a></p>
<p>用户手册http://wiki.ros.org/rospy_tutorials</p>
<p>​		http://wiki.ros.org/ROS/Tutorials/WritingPublisherSubscriber(python)</p>
<p>rqt界面工具 <a class="link" href="http://wiki.ros.org/rqt/Plugins"  target="_blank" rel="noopener"
    >http://wiki.ros.org/rqt/Plugins</a></p>
<p>TurtleBot3 <a class="link" href="http://turtlebot3.robotis.com/en/latest/"  target="_blank" rel="noopener"
    >http://turtlebot3.robotis.com/en/latest/</a></p>
<p>3D传感器工作原理https://www.youtube.com/watch?v=uq9SEJxZiUg</p>
<p>gmapping <a class="link" href="http://openslam.org/gmapping.html"  target="_blank" rel="noopener"
    >http://openslam.org/gmapping.html</a></p>
<h2 id="turtlebot3">Turtlebot3
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p ~/turtlebot3_ws/src
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ~/turtlebot3_ws/src
</span></span><span class="line"><span class="cl">catkin_init_workspace 
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ..
</span></span><span class="line"><span class="cl">catkin_make
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> turtlebot3_ws/src/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo apt-get install ros-noetic-joy ros-noetic-teleop-twist-joy ros-noetic-teleop-twist-keyboard ros-noetic-laser-proc ros-noetic-rgbd-launch ros-noetic-depthimage-to-laserscan ros-noetic-rosserial-arduino ros-noetic-rosserial-python ros-noetic-rosserial-server ros-noetic-rosserial-client ros-noetic-rosserial-msgs ros-noetic-amcl ros-noetic-map-server ros-noetic-move-base ros-noetic-urdf ros-noetic-xacro ros-noetic-compressed-image-transport ros-noetic-rqt-image-view ros-noetic-gmapping ros-noetic-navigation ros-noetic-interactive-markers
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">git clone https://github.com/ROBOTIS-GIT/turtlebot3_simulations.git
</span></span><span class="line"><span class="cl">git clone https://github.com/ROBOTIS-GIT/turtlebot3_msgs.git
</span></span><span class="line"><span class="cl">git clone  https://github.com/ROBOTIS-GIT/turtlebot3.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> turtlebot3_ws/
</span></span><span class="line"><span class="cl">catkin_make
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>vim ~/.bashrc</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">ROS_MASTER_URI</span><span class="o">=</span>http://localhost:11311/
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">ROS_HOSTNAME</span><span class="o">=</span>localhost
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">TURTLEBOT3_MODEL</span><span class="o">=</span>burger
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>source ~/.bashrc</code></p>
<h3 id="在riviz中启动turtlebot3模拟软件">在riviz中启动turtlebot3模拟软件
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">roslaunch turtlebot3_fake turtlebot3_fake.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="在gazebo中启动turtlebot3模拟软件">在gazebo中启动turtlebot3模拟软件
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">roslaunch turtlebot3_gazebo turtlebot3_empty_world.launch
</span></span><span class="line"><span class="cl">终止上述进程，打开一个包含有多个物体的场景
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">roslaunch turtlebot3_gazebo turtlebot3_world.launch 
</span></span><span class="line"><span class="cl">roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch 
</span></span><span class="line"><span class="cl">关闭键盘控制节点，打开自主导航和运动
</span></span><span class="line"><span class="cl">roslaunch turtlebot3_gazebo turtlebot3_simulation.launch 
</span></span><span class="line"><span class="cl">roslaunch turtlebot3_gazebo turtlebot3_gazebo_rviz.launch
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="实际turtlebot3机器人">实际Turtlebot3机器人
</h2><p>1.远程电脑安装Ubuntu、ROS、Turtlebot3、git克隆turtlebot3的包后，编译
2.SBC上安装Ubuntu、ROS、Turtlebot3、git克隆turtlebot3的包后，编译
3.Turtlebot3设置udev规则，树莓派上的USB口设置为无需root权限，保证外设设备正常运行</p>
<h3 id="turtlebot3与远程计算机网络连接">Turtlebot3与远程计算机网络连接
</h3><p>1.Turtlebot：
export ROS_MASTER_URI=http://IP_OF_REMOTE_PC:11311/
export ROS_HOSTNAME=IP_OF_Turtlebot
树莓派设置网络中始终连接到指定的网络
2.Remote PC：
export ROS_MASTER_URI=http://IP_OF_REMOTE_PC:11311/
export ROS_HOSTNAME=IP_OF_REMOTE_PC</p>
<h3 id="ssh连接">SSH连接
</h3><p>1.树莓派上检查SSH状态 <code>sudo service ssh status</code>
2.inactive则重启SSH服务：<code>sudo service ssh restart</code> <code>sudo systemctl enable ssh</code>
3.远程计算机上建立连接 <code>ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;</code>
检测<code>ping &lt;IP_OF_Turtlebot&gt;</code>
4.如果ping能够建立但SSH不能正常工作，重新安装SSH</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt-get remove openssh-client openssh-server
</span></span><span class="line"><span class="cl">sudo apt-get install openssh-client openssh-server
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="第四章-turtlebot机器人导航记录没运行过">第四章 Turtlebot机器人导航(记录，没运行过)
</h1><h2 id="配置3d传感器kinect">配置3D传感器Kinect
</h2><p><strong>Kinect的环境变量：</strong>
export KINECT_DRIVER=freenect
export TURTLEBOT_3D_SENSOR=kinect</p>
<h2 id="独立模式下测试3d传感器">独立模式下测试3D传感器
</h2><p>Turtlebot2上运行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">启动turtlebot的minimal launch
</span></span><span class="line"><span class="cl">roslaunch turtlebot3_bringup  minimal.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">启动相机nodelet包
</span></span><span class="line"><span class="cl">roslaunch freenect_launch freenect.launch
</span></span><span class="line"><span class="cl">ASUS或Carmine:
</span></span><span class="line"><span class="cl">roslaunch openni2_launch openni2.launch
</span></span><span class="line"><span class="cl">Inter RealSense:
</span></span><span class="line"><span class="cl">roslaunch realsense_camera r200_nodelet_default.launch
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="运行ros节点进行可视化">运行ROS节点进行可视化
</h2><h3 id="使用image-viewer可视化数据">使用Image Viewer可视化数据
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;
</span></span><span class="line"><span class="cl">roslaunch turtlebot_bringup  minimal.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;
</span></span><span class="line"><span class="cl">roslaunch freenect_launch freenect.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">rosrun image_view image_view image:<span class="o">=</span>/camera/rgb/image_color
</span></span><span class="line"><span class="cl">深度图像则是：
</span></span><span class="line"><span class="cl">rosrun image_view image_view image:<span class="o">=</span>/camera/depth/image
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="使用riz可视化数据">使用Riz可视化数据
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;
</span></span><span class="line"><span class="cl">roslaunch turtlebot_bringup  minimal.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">启动3D传感器相关软件（设置TURTLEBOT_3D_SENSOR环境变量）：
</span></span><span class="line"><span class="cl">ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;
</span></span><span class="line"><span class="cl">roslaunch turtlebot_bringup 3dsensor.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">rosrun turtlebot_rviz_launchers view_robot.launch
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="turtlebot机器人导航">Turtlebot机器人导航
</h2><p><strong>构建地图</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;
</span></span><span class="line"><span class="cl">roslaunch turtlebot_bringup  minimal.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">启动gmapping
</span></span><span class="line"><span class="cl">ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;
</span></span><span class="line"><span class="cl">roslaunch turtlebot_navigation gmapping_demo.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">启动Rviz
</span></span><span class="line"><span class="cl">roslaunch turtlebot_rviz_launchers view_navigation.launch
</span></span><span class="line"><span class="cl">Displays<span class="o">(</span>Grid/RobotModel/LaseScan/Bumper Hit/Map/GlobalMap/LocalMap/Amcl Particle Swarm/Full Plan<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">键盘控制
</span></span><span class="line"><span class="cl">roslaunch turtlebot_teleop turtlebot_teleop_key.launch 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">显示了完整的地图后，保存地图
</span></span><span class="line"><span class="cl">ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;
</span></span><span class="line"><span class="cl">rosrun map_server map_saver -f /home/&lt;turtlebot<span class="s1">&#39;s username&gt;/my_map
</span></span></span><span class="line"><span class="cl"><span class="s1">&lt;turtlebot&#39;</span>s username&gt;SSH登陆Turtlebot后使用pwd命令查看
</span></span></code></pre></td></tr></table>
</div>
</div><p>gmapping功能包基于OpenSlam(<a class="link" href="http://openslam.org/gmapping.html"  target="_blank" rel="noopener"
    >http://openslam.org/gmapping.html</a>)</p>
<h2 id="turtlebot机器人自主导航">Turtlebot机器人自主导航
</h2><h3 id="无人控制模式下驱动">无人控制模式下驱动
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;
</span></span><span class="line"><span class="cl">roslaunch turtlebot_bringup  minimal.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">启动amcl处理模块
</span></span><span class="line"><span class="cl">ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;
</span></span><span class="line"><span class="cl">roslaunch turtlebot_navigation amcl_demo.launch map_file:<span class="o">=</span>home/&lt;turtlebot<span class="err">&#39;</span>s username&gt;/my_map.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">rosrun turtlebot_rviz_launchers view_navigation.launch
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="导航至目标点">导航至目标点
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;
</span></span><span class="line"><span class="cl">roslaunch turtlebot_bringup  minimal.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">rostopic <span class="nb">echo</span> /odom/pose/pose
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;
</span></span><span class="line"><span class="cl">roslaunch turtlebot_navigation gmapping_demo.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">rostopic pub /move_base_simple/goal geometry_msgs/PoseStamped <span class="s1">&#39;{header:{ frame_id:&#34;map&#34;} ,pose:{ position:{ x: 1.0,y: 0,z: 0 },orientation:{ x: 1.0,y: 0,z: 0,w: 1 }}}&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="基于python脚本与地图实现航路点导航">基于python脚本与地图实现航路点导航
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;
</span></span><span class="line"><span class="cl">roslaunch turtlebot_bringup  minimal.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">启动acml程序
</span></span><span class="line"><span class="cl">ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;
</span></span><span class="line"><span class="cl">roslaunch turtlebot_navigation amcl_demo.launch map_file:<span class="o">=</span>home/&lt;turtlebot<span class="err">&#39;</span>s username&gt;/my_map.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">启动rviz并显示地图
</span></span><span class="line"><span class="cl">rosrun turtlebot_rviz_launchers view_navigation.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">地图上第一机器人的位置
</span></span><span class="line"><span class="cl">rostopic <span class="nb">echo</span> /initialpose
</span></span><span class="line"><span class="cl">定义路径点
</span></span><span class="line"><span class="cl">rostopic <span class="nb">echo</span> /clicked_point
</span></span><span class="line"><span class="cl">使用Python代码移动机器人
</span></span></code></pre></td></tr></table>
</div>
</div><p>python MoveTBtoGoalPoints.py</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python    # MoveTBtoGoalPoints</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">rospy</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">actionlib</span>       <span class="c1"># Use the actionlib package for client and server</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">move_base_msgs.msg</span> <span class="kn">import</span> <span class="n">MoveBaseAction</span><span class="p">,</span> <span class="n">MoveBaseGoal</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define Goal Points and orientations for TurtleBot in a list</span>
</span></span><span class="line"><span class="cl"><span class="n">GoalPoints</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)]</span> <span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">[(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.707</span><span class="p">,</span> <span class="mf">0.707</span><span class="p">)]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The function assign_goal initializes the goal_pose variable as a MoveBaseGoal action type.</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">assign_goal</span><span class="p">(</span><span class="n">pose</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">goal_pose</span> <span class="o">=</span> <span class="n">MoveBaseGoal</span><span class="p">()</span>        
</span></span><span class="line"><span class="cl">    <span class="n">goal_pose</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s1">&#39;map&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">goal_pose</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pose</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">goal_pose</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pose</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">goal_pose</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">pose</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">goal_pose</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pose</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">goal_pose</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pose</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">goal_pose</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">pose</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">goal_pose</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">pose</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">goal_pose</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;MoveTBtoGoalPoints&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Create a SimpleActionClient of a move_base action type and wait for server.</span>
</span></span><span class="line"><span class="cl">    <span class="n">client</span> <span class="o">=</span> <span class="n">actionlib</span><span class="o">.</span><span class="n">SimpleActionClient</span><span class="p">(</span><span class="s1">&#39;move_base&#39;</span><span class="p">,</span> <span class="n">MoveBaseAction</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">    <span class="n">client</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1">#       </span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">TBpose</span> <span class="ow">in</span> <span class="n">GoalPoints</span><span class="p">:</span>  
</span></span><span class="line"><span class="cl">        <span class="n">TBgoal</span> <span class="o">=</span> <span class="n">assign_goal</span><span class="p">(</span><span class="n">TBpose</span><span class="p">)</span>   <span class="c1"># For each goal point assign pose</span>
</span></span><span class="line"><span class="cl">        <span class="n">client</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="n">TBgoal</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">client</span><span class="o">.</span><span class="n">wait_for_result</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span> <span class="o">==</span> <span class="n">GoalStatus</span><span class="o">.</span><span class="n">SUCCEEDED</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&#34;success&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&#34;failed&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="turtlebot3机器人的slam">Turtlebot3机器人的SLAM
</h3><p>远程计算机上启动ROS MASTER
<code>roscore</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh &lt;username&gt;@&lt;IP_OF_Turtlebot&gt;
</span></span><span class="line"><span class="cl">roslaunch turtlebot3_bringup  turtlebot3_robot.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">TURTLEBOT3_MODEL</span><span class="o">=</span>burger
</span></span><span class="line"><span class="cl">roslaunch turtlebot3_slam turtlebot3_slam.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">可视化
</span></span><span class="line"><span class="cl">rosrun rviz rviz -d <span class="sb">`</span>rospack find turtlebot3_slam<span class="sb">`</span>/rviz/turtlebot3_slam.rviz
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">保存地图
</span></span><span class="line"><span class="cl">rosrun map_server map_saver -f ~/map
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Turtlebot3自主导航</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">启动导航软件
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">TURTLEBOT3_MODEL</span><span class="o">=</span>burger
</span></span><span class="line"><span class="cl">roslaunch turtlebot3_navigation turtlebot3_navigation.launch map_file:<span class="o">=</span>map.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">可视化
</span></span><span class="line"><span class="cl">rosrun rviz rviz -d <span class="sb">`</span>rospack find turtlebot3_navigation<span class="sb">`</span>/rviz/turtlebot3_nav.rviz
</span></span></code></pre></td></tr></table>
</div>
</div><p>ROS导航
<a class="link" href="http://wiki.ros.org/navigation"  target="_blank" rel="noopener"
    >http://wiki.ros.org/navigation</a>
<a class="link" href="http://wiki.ros.org/navigation/Tutorials/RobotSetup"  target="_blank" rel="noopener"
    >http://wiki.ros.org/navigation/Tutorials/RobotSetup</a>
<a class="link" href="http://wiki.ros.org/navigation/Tutorials/Navigation%20Tuning20Guide"  target="_blank" rel="noopener"
    >http://wiki.ros.org/navigation/Tutorials/Navigation%20Tuning20Guide</a></p>
<h1 id="第五章-构建模拟的机器人手臂">第五章 构建模拟的机器人手臂
</h1><p><strong>Xacro</strong>是用于ROS的XML宏语言，提供一系列的宏操作来替换一些重复性的声明语句。</p>
<h2 id="1利用xacro建立一个关节式机器人手臂urdf">1.利用Xacro建立一个关节式机器人手臂URDF
</h2><p><strong>~/catkin_ws/src/ros_robotics/urdf/rrbot.xacro:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- Revolute-Revolute Manipulator --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;robot</span> <span class="na">name=</span><span class="s">&#34;rrbot&#34;</span> <span class="na">xmlns:xacro=</span><span class="s">&#34;http://www.ros.org/wiki/xacro&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Constants for robot dimensions --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;width&#34;</span> <span class="na">value=</span><span class="s">&#34;0.1&#34;</span> <span class="nt">/&gt;</span>   <span class="c">&lt;!-- Beams are square in length and width --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;height1&#34;</span> <span class="na">value=</span><span class="s">&#34;2&#34;</span> <span class="nt">/&gt;</span>   <span class="c">&lt;!-- Link 1 --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;height2&#34;</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span> <span class="nt">/&gt;</span>   <span class="c">&lt;!-- Link 2 --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;height3&#34;</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span> <span class="nt">/&gt;</span>   <span class="c">&lt;!-- Link 3 --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;axle_offset&#34;</span> <span class="na">value=</span><span class="s">&#34;0.05&#34;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- Space between joint and end of beam --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;damp&#34;</span> <span class="na">value=</span><span class="s">&#34;0.7&#34;</span> <span class="nt">/&gt;</span>    <span class="c">&lt;!-- damping coefficient --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Base Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;base_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height1/2}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height1}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height1/2}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height1}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;inertial&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height1/2}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;inertia</span>
</span></span><span class="line"><span class="cl">	  <span class="na">ixx=</span><span class="s">&#34;1.0&#34;</span> <span class="na">ixy=</span><span class="s">&#34;0.0&#34;</span> <span class="na">ixz=</span><span class="s">&#34;0.0&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="na">iyy=</span><span class="s">&#34;1.0&#34;</span> <span class="na">iyz=</span><span class="s">&#34;0.0&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="na">izz=</span><span class="s">&#34;1.0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/inertial&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Joint between Base Link and Middle Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;joint_base_mid&#34;</span> <span class="na">type=</span><span class="s">&#34;revolute&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;base_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;mid_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 ${width} ${height1 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">&#34;0 1 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dynamics</span> <span class="na">damping=</span><span class="s">&#34;${damp}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">&#34;100.0&#34;</span> <span class="na">velocity=</span><span class="s">&#34;0.5&#34;</span> <span class="na">lower=</span><span class="s">&#34;-3.14&#34;</span> <span class="na">upper=</span><span class="s">&#34;3.14&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Middle Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;mid_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height2/2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height2}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height2/2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height2}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;inertial&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height2/2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;inertia</span>
</span></span><span class="line"><span class="cl">	  <span class="na">ixx=</span><span class="s">&#34;1.0&#34;</span> <span class="na">ixy=</span><span class="s">&#34;0.0&#34;</span> <span class="na">ixz=</span><span class="s">&#34;0.0&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="na">iyy=</span><span class="s">&#34;1.0&#34;</span> <span class="na">iyz=</span><span class="s">&#34;0.0&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="na">izz=</span><span class="s">&#34;1.0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/inertial&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Joint between Middle Link and Top Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;joint_mid_top&#34;</span> <span class="na">type=</span><span class="s">&#34;revolute&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;mid_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;top_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 ${width} ${height2 - axle_offset*2}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">&#34;0 1 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dynamics</span> <span class="na">damping=</span><span class="s">&#34;${damp}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">&#34;100.0&#34;</span> <span class="na">velocity=</span><span class="s">&#34;0.5&#34;</span> <span class="na">lower=</span><span class="s">&#34;-3.14&#34;</span> <span class="na">upper=</span><span class="s">&#34;3.14&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Top Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;top_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height3/2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height3}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height3/2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height3}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;inertial&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height3/2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;inertia</span>
</span></span><span class="line"><span class="cl">	  <span class="na">ixx=</span><span class="s">&#34;1.0&#34;</span> <span class="na">ixy=</span><span class="s">&#34;0.0&#34;</span> <span class="na">ixz=</span><span class="s">&#34;0.0&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="na">iyy=</span><span class="s">&#34;1.0&#34;</span> <span class="na">iyz=</span><span class="s">&#34;0.0&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="na">izz=</span><span class="s">&#34;1.0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/inertial&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/robot&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>包含三连杆元素，长宽均为0.1m，高分别为2m，1m，1m。base_link的原点坐标为（0,0,1），目的在于机械臂在Rviz下能够位于地面之上。</p>
<p>关节元素两个新的标签： &lt;dynamics damping&gt;和 &lt;limit&gt;，动态阻尼系数设置为0.7Nms/rad，该阻尼是对任意速度的关节施加的反向作用力的数值之和，用于降低机械臂的运动速度。</p>
<h2 id="2扩展xacro"><strong>2.扩展Xacro</strong>
</h2><p>将所有的宏进行扩展，并输出一个生成的URDF文件。</p>
<p>位于文件相同的目录下运行	<code>$ rosrun xacro xacro --inorder rrbot.xacro &gt; rrbot.urdf</code></p>
<p>通过launch文件生成URDF文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">  <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&#34;robot_description&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">command=</span><span class="s">&#34;$(find xacro)/xacro --inorder 
</span></span></span><span class="line"><span class="cl"><span class="s">    &#39;$(find ros_robotics)/urdf/$(arg model)&#39;&#34;</span> <span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>~/catkin_ws/src/ros_robotics/launch/rrbot_rviz.launch:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;launch&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- set parameter on Parameter Server --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;model&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&#34;robot_description&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">command=</span><span class="s">&#34;$(find xacro)/xacro --inorder &#39;$(find ros_robotics)/urdf/$(arg model)&#39;&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- send joint values from gui --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&#34;joint_state_publisher&#34;</span> <span class="na">pkg=</span><span class="s">&#34;joint_state_publisher&#34;</span> <span class="na">type=</span><span class="s">&#34;joint_state_publisher&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&#34;use_gui&#34;</span> <span class="na">value=</span><span class="s">&#34;TRUE&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/node&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- use joint positions to update tf --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&#34;robot_state_publisher&#34;</span> <span class="na">pkg=</span><span class="s">&#34;robot_state_publisher&#34;</span> <span class="na">type=</span><span class="s">&#34;robot_state_publisher&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- visualize robot model in 3D --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&#34;rviz&#34;</span> <span class="na">pkg=</span><span class="s">&#34;rviz&#34;</span> <span class="na">type=</span><span class="s">&#34;rviz&#34;</span> <span class="na">args=</span><span class="s">&#34;-d $(find ros_robotics)/urdf.rviz&#34;</span> <span class="na">required=</span><span class="s">&#34;true&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/launch&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>需要将.bashrc文件(主目录隐藏文件)中已经添加了自己的环境变量ROS_MASTER_URI和ROS_HOSTNAME或ROS_IP注释掉，添加以下两行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="k">export</span> <span class="n">ROS_MASTER_URI</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">11311</span><span class="o">//</span>
</span></span><span class="line"><span class="cl"><span class="k">export</span> <span class="n">ROS_HOSTNAME</span><span class="o">=</span><span class="n">localhost</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>运行rviz的roslaunch命令:</strong></p>
<p><code>$ roslaunch ros_robotics rrbot_rviz.launch model:=rrbot.xzcro</code></p>
<h2 id="3添加颜色"><strong>3.添加颜色</strong>
</h2><p><strong>~/catkin_ws/src/ros_robotics/urdf/materials.xacro:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;robot&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;black&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">&#34;0.0 0.0 0.0 1.0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;blue&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">&#34;0.0 0.0 0.8 1.0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;green&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">&#34;0.0 1.0 0.0 1.0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;grey&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">&#34;0.2 0.2 0.2 1.0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;orange&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">&#34;${255/255} ${108/255} ${10/255} 1.0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;brown&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">&#34;${222/255} ${207/255} ${195/255} 1.0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;red&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">&#34;0.8 0.0 0.0 1.0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;white&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;color</span> <span class="na">rgba=</span><span class="s">&#34;1.0 1.0 1.0 1.0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/robot&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在每一个连接杆组件添加</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"> <span class="nt">&lt;xacro:include</span> <span class="na">filename=</span><span class="s">&#34;$(find ros_robotics)/urdf/materials.xacro&#34;</span> <span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="4惯性的宏使用"><strong>4.惯性的宏使用</strong>
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">  <span class="c">&lt;!-- Default Inertial --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:macro</span> <span class="na">name=</span><span class="s">&#34;default_inertial&#34;</span> <span class="na">params=</span><span class="s">&#34;z_value i_value mass&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;inertial&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${z_value}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&#34;${mass}&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;inertia</span> <span class="na">ixx=</span><span class="s">&#34;${i_value}&#34;</span> <span class="na">ixy=</span><span class="s">&#34;0.0&#34;</span> <span class="na">ixz=</span><span class="s">&#34;0.0&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="na">iyy=</span><span class="s">&#34;${i_value}&#34;</span> <span class="na">iyz=</span><span class="s">&#34;0.0&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="na">izz=</span><span class="s">&#34;${i_value}&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/inertial&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/xacro:macro&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在每一个link里，使用以下代码替换完整的&lt;inertial&gt;块：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;xacro:default_inertial</span> <span class="na">z_value=</span><span class="s">&#34;${height1/2}&#34;</span> <span class="na">i_value=</span><span class="s">&#34;1.0&#34;</span> <span class="na">mass=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="5添加抓手"><strong>5.添加抓手</strong>
</h2><p>使用来自PR2机器人的网格文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">**主文件rrbot4.xacro中添加：**
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">​```xml
</span></span><span class="line"><span class="cl">  &lt;xacro:include filename=&#34;$(find ros_robotics)/urdf/gripper.xacro&#34; /&gt;  
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>四个连接杆分别为left_gripper、left_tip、right_gripper、right_tip</p>
</li>
<li>
<p>pr2_description是ros-kinetic-desktop-full的组成部分，可以在/opt/ros/kinetic/share/pr2_description/meshes/gripper_v0目录找到文件</p>
</li>
<li>
<p>需要在ros_robotics功能包目录下创建一个/meshes文件目录，并将1_finger.dae和1_finger_tip.dae复制到该目录下。</p>
</li>
</ul>
<p><strong>left_gripper:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"> <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;left_gripper&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;mesh</span> <span class="na">filename=</span><span class="s">&#34;package://ros_robotics/meshes/l_finger.dae&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>~/catkin_ws/src/ros_robotics/urdf/gripper.xacro:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;robot</span> <span class="na">xmlns:xacro=</span><span class="s">&#34;http://www.ros.org/wiki/xacro&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Gripper --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;left_gripper_joint&#34;</span> <span class="na">type=</span><span class="s">&#34;revolute&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;top_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;left_gripper&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 -1.57 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">&#34;0 0 -1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">&#34;30.0&#34;</span> <span class="na">lower=</span><span class="s">&#34;-0.548&#34;</span> <span class="na">upper=</span><span class="s">&#34;0.0&#34;</span> <span class="na">velocity=</span><span class="s">&#34;0.1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;left_gripper&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;mesh</span> <span class="na">filename=</span><span class="s">&#34;package://ros_robotics/meshes/l_finger.dae&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">xyz=</span><span class="s">&#34;0.05 0.025 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;0.1 0.05 0.05&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;xacro:default_inertial</span> <span class="na">z_value=</span><span class="s">&#34;0&#34;</span> <span class="na">i_value=</span><span class="s">&#34;1e-6&#34;</span> <span class="na">mass=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;left_tip_joint&#34;</span> <span class="na">type=</span><span class="s">&#34;fixed&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;left_gripper&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;left_tip&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;left_tip&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">xyz=</span><span class="s">&#34;0.09137 0.00495 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;mesh</span> <span class="na">filename=</span><span class="s">&#34;package://ros_robotics/meshes/l_finger_tip.dae&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">xyz=</span><span class="s">&#34;0.11 0.005 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;0.02 0.03 0.02&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;xacro:default_inertial</span> <span class="na">z_value=</span><span class="s">&#34;0&#34;</span> <span class="na">i_value=</span><span class="s">&#34;1e-6&#34;</span> <span class="na">mass=</span><span class="s">&#34;1e-5&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;right_gripper_joint&#34;</span> <span class="na">type=</span><span class="s">&#34;revolute&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;top_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;right_gripper&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 -1.57 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">&#34;0 0 1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">&#34;30.0&#34;</span> <span class="na">lower=</span><span class="s">&#34;-0.548&#34;</span> <span class="na">upper=</span><span class="s">&#34;0.0&#34;</span> <span class="na">velocity=</span><span class="s">&#34;0.1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;right_gripper&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">&#34;3.1415 0 0&#34;</span> <span class="na">xyz=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;mesh</span> <span class="na">filename=</span><span class="s">&#34;package://ros_robotics/meshes/l_finger.dae&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">xyz=</span><span class="s">&#34;0.05 -0.025 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;0.1 0.05 0.05&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;xacro:default_inertial</span> <span class="na">z_value=</span><span class="s">&#34;0&#34;</span> <span class="na">i_value=</span><span class="s">&#34;1e-6&#34;</span> <span class="na">mass=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;right_tip_joint&#34;</span> <span class="na">type=</span><span class="s">&#34;fixed&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;right_gripper&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;right_tip&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;right_tip&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">&#34;-3.1415 0 0&#34;</span> <span class="na">xyz=</span><span class="s">&#34;0.09137 0.00495 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;mesh</span> <span class="na">filename=</span><span class="s">&#34;package://ros_robotics/meshes/l_finger_tip.dae&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span> <span class="na">xyz=</span><span class="s">&#34;0.11 -0.005 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;0.02 0.03 0.02&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;xacro:default_inertial</span> <span class="na">z_value=</span><span class="s">&#34;0&#34;</span> <span class="na">i_value=</span><span class="s">&#34;1e-6&#34;</span> <span class="na">mass=</span><span class="s">&#34;1e-5&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;transmission</span> <span class="na">name=</span><span class="s">&#34;gripper_transmission1&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;type&gt;</span>transmission_interface/SimpleTransmission<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;left_gripper_joint&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;hardwareInterface&gt;</span>hardware_interface/EffortJointInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;actuator</span> <span class="na">name=</span><span class="s">&#34;gripper_motor1&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mechanicalReduction&gt;</span>1<span class="nt">&lt;/mechanicalReduction&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/actuator&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/transmission&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;transmission</span> <span class="na">name=</span><span class="s">&#34;gripper_transmission2&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;type&gt;</span>transmission_interface/SimpleTransmission<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;right_gripper_joint&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;hardwareInterface&gt;</span>hardware_interface/EffortJointInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;actuator</span> <span class="na">name=</span><span class="s">&#34;gripper_motor2&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mechanicalReduction&gt;</span>1<span class="nt">&lt;/mechanicalReduction&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/actuator&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/transmission&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/robot&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>~/catkin_ws/src/ros_robotics/urdf/rrbot3.xacro:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- Revolute-Revolute Manipulator --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;robot</span> <span class="na">name=</span><span class="s">&#34;rrbot&#34;</span> <span class="na">xmlns:xacro=</span><span class="s">&#34;http://www.ros.org/wiki/xacro&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Constants for robot dimensions --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;width&#34;</span> <span class="na">value=</span><span class="s">&#34;0.1&#34;</span> <span class="nt">/&gt;</span>   <span class="c">&lt;!-- Beams are square in length and width --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;height1&#34;</span> <span class="na">value=</span><span class="s">&#34;2&#34;</span> <span class="nt">/&gt;</span>   <span class="c">&lt;!-- Link 1 --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;height2&#34;</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span> <span class="nt">/&gt;</span>   <span class="c">&lt;!-- Link 2 --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;height3&#34;</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span> <span class="nt">/&gt;</span>   <span class="c">&lt;!-- Link 3 --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;axle_offset&#34;</span> <span class="na">value=</span><span class="s">&#34;0.05&#34;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- Space between joint and end of beam --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;damp&#34;</span> <span class="na">value=</span><span class="s">&#34;0.7&#34;</span> <span class="nt">/&gt;</span>    <span class="c">&lt;!-- damping coefficient --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Default Inertial --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:macro</span> <span class="na">name=</span><span class="s">&#34;default_inertial&#34;</span> <span class="na">params=</span><span class="s">&#34;z_value i_value mass&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;inertial&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${z_value}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&#34;${mass}&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;inertia</span> <span class="na">ixx=</span><span class="s">&#34;${i_value}&#34;</span> <span class="na">ixy=</span><span class="s">&#34;0.0&#34;</span> <span class="na">ixz=</span><span class="s">&#34;0.0&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="na">iyy=</span><span class="s">&#34;${i_value}&#34;</span> <span class="na">iyz=</span><span class="s">&#34;0.0&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="na">izz=</span><span class="s">&#34;${i_value}&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/inertial&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/xacro:macro&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Import Rviz colors --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:include</span> <span class="na">filename=</span><span class="s">&#34;$(find ros_robotics)/urdf/materials.xacro&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Import gripper URDF --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:include</span> <span class="na">filename=</span><span class="s">&#34;$(find ros_robotics)/urdf/gripper.xacro&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Base Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;base_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height1/2}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height1}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;red&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height1/2}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height1}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;xacro:default_inertial</span> <span class="na">z_value=</span><span class="s">&#34;${height1/2}&#34;</span> <span class="na">i_value=</span><span class="s">&#34;1.0&#34;</span> <span class="na">mass=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Joint between Base Link and Middle Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;joint_base_mid&#34;</span> <span class="na">type=</span><span class="s">&#34;revolute&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;base_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;mid_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 ${width} ${height1 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">&#34;0 1 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dynamics</span> <span class="na">damping=</span><span class="s">&#34;${damp}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">&#34;100.0&#34;</span> <span class="na">velocity=</span><span class="s">&#34;0.5&#34;</span> <span class="na">lower=</span><span class="s">&#34;-3.14&#34;</span> <span class="na">upper=</span><span class="s">&#34;3.14&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Middle Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;mid_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height2/2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height2}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;green&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height2/2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height2}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;xacro:default_inertial</span> <span class="na">z_value=</span><span class="s">&#34;${height2/2 - axle_offset}&#34;</span> <span class="na">i_value=</span><span class="s">&#34;1.0&#34;</span> <span class="na">mass=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Joint between Middle Link and Top Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;joint_mid_top&#34;</span> <span class="na">type=</span><span class="s">&#34;revolute&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;mid_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;top_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 ${width} ${height2 - axle_offset*2}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">&#34;0 1 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dynamics</span> <span class="na">damping=</span><span class="s">&#34;${damp}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">&#34;100.0&#34;</span> <span class="na">velocity=</span><span class="s">&#34;0.5&#34;</span> <span class="na">lower=</span><span class="s">&#34;-3.14&#34;</span> <span class="na">upper=</span><span class="s">&#34;3.14&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Top Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;top_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height3/2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height3}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;blue&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height3/2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height3}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;xacro:default_inertial</span> <span class="na">z_value=</span><span class="s">&#34;${height3/2 - axle_offset}&#34;</span> <span class="na">i_value=</span><span class="s">&#34;1.0&#34;</span> <span class="na">mass=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/robot&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行Rviz的roslaunch命令</p>
<p><code>$ roslaunch ros_robotics rrbot_rviz.launch model:=rrbot3.xacro</code></p>
<h2 id="6在gazebo中控制关节式机器人手臂">6.在Gazebo中控制关节式机器人手臂
</h2><p>gazebo下模拟环境下所独有的特性元素主要有</p>
<ul>
<li>&lt;material&gt;标签，指定每一个连接杆的颜色或纹理</li>
<li>&lt;mu1&gt;和&lt;mu2&gt;标签，用于定义四个表面相互接触的机器人连接杆的摩擦系数</li>
<li>用于控制rrbot的旋转副关节的插件</li>
</ul>
<p>这些特定的Gazebo XML元素，存储在单独的文件中：</p>
<p><strong>~/catkin_ws/src/ros_robotics/urdf/rrbot.gazebo:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;robot&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- ros_control plugin --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;gazebo&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">&#34;gazebo_ros_control&#34;</span> <span class="na">filename=</span><span class="s">&#34;libgazebo_ros_control.so&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;robotNamespace&gt;</span>/rrbot<span class="nt">&lt;/robotNamespace&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;robotSimType&gt;</span>gazebo_ros_control/DefaultRobotHWSim<span class="nt">&lt;/robotSimType&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/gazebo&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Base Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;gazebo</span> <span class="na">reference=</span><span class="s">&#34;base_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;material&gt;</span>Gazebo/Red<span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/gazebo&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Middle Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;gazebo</span> <span class="na">reference=</span><span class="s">&#34;mid_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mu1&gt;</span>0.2<span class="nt">&lt;/mu1&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mu2&gt;</span>0.2<span class="nt">&lt;/mu2&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;material&gt;</span>Gazebo/Green<span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/gazebo&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Top Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;gazebo</span> <span class="na">reference=</span><span class="s">&#34;top_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mu1&gt;</span>0.2<span class="nt">&lt;/mu1&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mu2&gt;</span>0.2<span class="nt">&lt;/mu2&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;material&gt;</span>Gazebo/Blue<span class="nt">&lt;/material&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/gazebo&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Gripper Elements --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;gazebo</span> <span class="na">reference=</span><span class="s">&#34;left_gripper&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mu1&gt;</span>0.2<span class="nt">&lt;/mu1&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mu2&gt;</span>0.2<span class="nt">&lt;/mu2&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/gazebo&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;gazebo</span> <span class="na">reference=</span><span class="s">&#34;right_gripper&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mu1&gt;</span>0.2<span class="nt">&lt;/mu1&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mu2&gt;</span>0.2<span class="nt">&lt;/mu2&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/gazebo&gt;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;gazebo</span> <span class="na">reference=</span><span class="s">&#34;left_tip&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;gazebo</span> <span class="na">reference=</span><span class="s">&#34;right_tip&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/robot&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>在主文件使用Xacro的声明</strong></p>
<p><code>&lt;xacro:include filename=&quot;$(find ros_robotics)/urdf/rrbot.gazebo&quot; /&gt;</code></p>
<p>将机器人手臂固定在世界坐标系下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;world&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;fixed&#34;</span> <span class="na">type=</span><span class="s">&#34;fixed&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;world&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;base_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>~/catkin_ws/src/ros_robotics/urdf/rrbot4.xacro:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- Revolute-Revolute Manipulator --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;robot</span> <span class="na">name=</span><span class="s">&#34;rrbot&#34;</span> <span class="na">xmlns:xacro=</span><span class="s">&#34;http://www.ros.org/wiki/xacro&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Constants for robot dimensions --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;PI&#34;</span> <span class="na">value=</span><span class="s">&#34;3.14&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;width&#34;</span> <span class="na">value=</span><span class="s">&#34;0.1&#34;</span> <span class="nt">/&gt;</span>   <span class="c">&lt;!-- Beams are square in length and width --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;height1&#34;</span> <span class="na">value=</span><span class="s">&#34;2&#34;</span> <span class="nt">/&gt;</span>   <span class="c">&lt;!-- Link 1 --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;height2&#34;</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span> <span class="nt">/&gt;</span>   <span class="c">&lt;!-- Link 2 --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;height3&#34;</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span> <span class="nt">/&gt;</span>   <span class="c">&lt;!-- Link 3 --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;axle_offset&#34;</span> <span class="na">value=</span><span class="s">&#34;0.05&#34;</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- Space between joint and end of beam --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&#34;damp&#34;</span> <span class="na">value=</span><span class="s">&#34;0.7&#34;</span> <span class="nt">/&gt;</span>    <span class="c">&lt;!-- damping coefficient --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Default Inertial --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:macro</span> <span class="na">name=</span><span class="s">&#34;default_inertial&#34;</span> <span class="na">params=</span><span class="s">&#34;z_value i_value mass&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;inertial&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${z_value}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&#34;${mass}&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;inertia</span> <span class="na">ixx=</span><span class="s">&#34;${i_value}&#34;</span> <span class="na">ixy=</span><span class="s">&#34;0.0&#34;</span> <span class="na">ixz=</span><span class="s">&#34;0.0&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="na">iyy=</span><span class="s">&#34;${i_value}&#34;</span> <span class="na">iyz=</span><span class="s">&#34;0.0&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="na">izz=</span><span class="s">&#34;${i_value}&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/inertial&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/xacro:macro&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Import Rviz colors --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:include</span> <span class="na">filename=</span><span class="s">&#34;$(find ros_robotics)/urdf/materials.xacro&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Import gripper URDF --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:include</span> <span class="na">filename=</span><span class="s">&#34;$(find ros_robotics)/urdf/gripper.xacro&#34;</span> <span class="nt">/&gt;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Import Gazebo elements, including Gazebo colors --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;xacro:include</span> <span class="na">filename=</span><span class="s">&#34;$(find ros_robotics)/urdf/rrbot.gazebo&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Used for fixing rrbot frame to Gazebo world frame --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;world&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;fixed&#34;</span> <span class="na">type=</span><span class="s">&#34;fixed&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;world&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;base_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Base Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;base_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height1/2}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height1}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;red&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height1/2}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height1}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;xacro:default_inertial</span> <span class="na">z_value=</span><span class="s">&#34;${height1/2}&#34;</span> <span class="na">i_value=</span><span class="s">&#34;1.0&#34;</span> <span class="na">mass=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Joint between Base Link and Middle Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;joint_base_mid&#34;</span> <span class="na">type=</span><span class="s">&#34;revolute&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;base_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;mid_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 ${width} ${height1 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">&#34;0 1 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dynamics</span> <span class="na">damping=</span><span class="s">&#34;${damp}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">&#34;100.0&#34;</span> <span class="na">velocity=</span><span class="s">&#34;0.5&#34;</span> <span class="na">lower=</span><span class="s">&#34;-3.14&#34;</span> <span class="na">upper=</span><span class="s">&#34;3.14&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Middle Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;mid_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height2/2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height2}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;green&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height2/2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height2}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;xacro:default_inertial</span> <span class="na">z_value=</span><span class="s">&#34;${height2/2 - axle_offset}&#34;</span> <span class="na">i_value=</span><span class="s">&#34;1.0&#34;</span> <span class="na">mass=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Joint between Middle Link and Top Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;joint_mid_top&#34;</span> <span class="na">type=</span><span class="s">&#34;revolute&#34;</span><span class="nt">&gt;</span> 
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&#34;mid_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&#34;top_link&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 ${width} ${height2 - axle_offset*2}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">&#34;0 1 0&#34;</span><span class="nt">/&gt;</span> 
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dynamics</span> <span class="na">damping=</span><span class="s">&#34;${damp}&#34;</span><span class="nt">/&gt;</span> 
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">&#34;100.0&#34;</span> <span class="na">velocity=</span><span class="s">&#34;0.5&#34;</span> <span class="na">lower=</span><span class="s">&#34;-3.14&#34;</span> <span class="na">upper=</span><span class="s">&#34;3.14&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Top Link --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&#34;top_link&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;visual&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height3/2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height3}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&#34;blue&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/visual&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;collision&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&#34;0 0 ${height3/2 - axle_offset}&#34;</span> <span class="na">rpy=</span><span class="s">&#34;0 0 0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;geometry&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&#34;${width} ${width} ${height3}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/geometry&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/collision&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;xacro:default_inertial</span> <span class="na">z_value=</span><span class="s">&#34;${height3/2 - axle_offset}&#34;</span> <span class="na">i_value=</span><span class="s">&#34;1.0&#34;</span> <span class="na">mass=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/link&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;transmission</span> <span class="na">name=</span><span class="s">&#34;transmission1&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;type&gt;</span>transmission_interface/SimpleTransmission<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;joint_base_mid&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;hardwareInterface&gt;</span>hardware_interface/EffortJointInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;actuator</span> <span class="na">name=</span><span class="s">&#34;motor1&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mechanicalReduction&gt;</span>1<span class="nt">&lt;/mechanicalReduction&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/actuator&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/transmission&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;transmission</span> <span class="na">name=</span><span class="s">&#34;transmission2&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;type&gt;</span>transmission_interface/SimpleTransmission<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;joint_mid_top&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;hardwareInterface&gt;</span>hardware_interface/EffortJointInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;actuator</span> <span class="na">name=</span><span class="s">&#34;motor2&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mechanicalReduction&gt;</span>1<span class="nt">&lt;/mechanicalReduction&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/actuator&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/transmission&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/robot&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>launch文件：</p>
<p><strong>~/catkin_ws/src/ros_robotics/launch/rrbot_gazebo.launch:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;launch&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- We resume the logic in gazebo_ros package empty_world.launch, --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- changing only the name of the world to be launched --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">&#34;$(find gazebo_ros)/launch/empty_world.launch&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;world_name&#34;</span> <span class="na">value=</span><span class="s">&#34;$(find ros_robotics)/worlds/rrbot.world&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;paused&#34;</span> <span class="na">default=</span><span class="s">&#34;false&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;use_sim_time&#34;</span> <span class="na">default=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;gui&#34;</span> <span class="na">default=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;headless&#34;</span> <span class="na">default=</span><span class="s">&#34;false&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&#34;debug&#34;</span> <span class="na">default=</span><span class="s">&#34;false&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/include&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Load the URDF into the ROS Parameter Server --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&#34;robot_description&#34;</span>
</span></span><span class="line"><span class="cl">	 <span class="na">command=</span><span class="s">&#34;$(find xacro)/xacro --inorder &#39;$(find ros_robotics)/urdf/rrbot4.xacro&#39;&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Spawn rrbot into Gazebo --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&#34;spawn_urdf&#34;</span> <span class="na">pkg=</span><span class="s">&#34;gazebo_ros&#34;</span> <span class="na">type=</span><span class="s">&#34;spawn_model&#34;</span> <span class="na">respawn=</span><span class="s">&#34;false&#34;</span> <span class="na">output=</span><span class="s">&#34;screen&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="na">args=</span><span class="s">&#34;-param robot_description -urdf -model rrbot&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/launch&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在gazebo中启动机器人手臂命令</p>
<p><code>$ roslaunch ros_robotics rrbot_gazebo.launch</code></p>
<h2 id="7给xacro添加控制组件">7.给Xacro添加控制组件
</h2><p><strong>在gazebo模拟环境下为机器人手臂添加控制组件的步骤如下</strong></p>
<ol>
<li>为rrbot以及抓手Xacro文件中的关节组件定义为传动元素</li>
<li>为gazebo特性元素添加gazebo_ros_control插件</li>
<li>生成用于控制参数的YAML配置文件</li>
<li>生成用于启动机器人关节控制器的控制启动文件</li>
</ol>
<p>需要安装四个功能包：gazebo_ros_pkgs、gezebo_ros_control、ros_control、ros_controllers。</p>
<p>gazebo_ros_pkgs提供gazebo下机器人的接口和控制。ros_control、ros_controllers提供用于ROS机器人控制的基本控制器。</p>
<p><strong>安装Debian功能包</strong></p>
<p><code>$ sudo apt-get install ros-kinetic-gazebo-ros-pkgs ros-kinetic-gazebo-ros-control ros-kinetic-ros-control ros-kinetic-ros-controllers</code></p>
<p>参考http://wiki.ros.org/ros_control</p>
<h3 id="1定义关节的传动元素"><strong>（1）定义关节的传动元素</strong>
</h3><p>&lt;transmission&gt;用于定义机器人关节和执行器间的相互关系。每一个旋转副关节(joint_base_mid、joint_mid_top、left_gripper、right_gripper)都需要一个&lt;transmission&gt;元素。</p>
<p>&lt;transmission&gt;元素的内容相似:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"> <span class="nt">&lt;transmission</span> <span class="na">name=</span><span class="s">&#34;transmission1&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;type&gt;</span>transmission_interface/SimpleTransmission<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&#34;joint_base_mid&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;hardwareInterface&gt;</span>hardware_interface/EffortJointInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/joint&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;actuator</span> <span class="na">name=</span><span class="s">&#34;motor1&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;mechanicalReduction&gt;</span>1<span class="nt">&lt;/mechanicalReduction&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/actuator&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/transmission&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述代码在rrbot4.xacro中</p>
<h3 id="2添加gazebo的ros控制插件"><strong>（2）添加Gazebo的ROS控制插件</strong>
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">  <span class="c">&lt;!-- ros_control plugin --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;gazebo&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">&#34;gazebo_ros_control&#34;</span> <span class="na">filename=</span><span class="s">&#34;libgazebo_ros_control.so&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;robotNamespace&gt;</span>/rrbot<span class="nt">&lt;/robotNamespace&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;robotSimType&gt;</span>gazebo_ros_control/DefaultRobotHWSim<span class="nt">&lt;/robotSimType&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/gazebo&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述代码在rrbot.gazebo中</p>
<h3 id="3生成yaml配置文件"><strong>（3）生成YAML配置文件</strong>
</h3><p>YAML是一种常见于ROS参数中的标记语言。在参数服务器上使用YAML格式的文件对ROS的参数进行设置。创建一个用于存放关节控制器配置参数的YAML文件，该YAML文件由控制启动文件加载。定义四个rrbot控制器的比例积分微分增益。</p>
<p><strong>~/catkin_ws/src/ros_robotics/config/rrbot_control.yaml:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">rrbot:
</span></span><span class="line"><span class="cl">  # Publish all joint states -----------------------------------
</span></span><span class="line"><span class="cl">  joint_state_controller:
</span></span><span class="line"><span class="cl">    type: joint_state_controller/JointStateController
</span></span><span class="line"><span class="cl">    publish_rate: 50  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  # Position Controllers ---------------------------------------
</span></span><span class="line"><span class="cl">  joint_base_mid_position_controller:
</span></span><span class="line"><span class="cl">    type: effort_controllers/JointPositionController
</span></span><span class="line"><span class="cl">    joint: joint_base_mid
</span></span><span class="line"><span class="cl">    pid: {p: 100.0, i: 0.01, d: 10.0}
</span></span><span class="line"><span class="cl">  joint_mid_top_position_controller:
</span></span><span class="line"><span class="cl">    type: effort_controllers/JointPositionController
</span></span><span class="line"><span class="cl">    joint: joint_mid_top
</span></span><span class="line"><span class="cl">    pid: {p: 100.0, i: 0.01, d: 10.0}
</span></span><span class="line"><span class="cl">  left_gripper_joint_position_controller:
</span></span><span class="line"><span class="cl">    type: effort_controllers/JointPositionController
</span></span><span class="line"><span class="cl">    joint: left_gripper_joint
</span></span><span class="line"><span class="cl">    pid: {p: 1.0, i: 0.00, d: 0.0}
</span></span><span class="line"><span class="cl">  right_gripper_joint_position_controller:
</span></span><span class="line"><span class="cl">    type: effort_controllers/JointPositionController
</span></span><span class="line"><span class="cl">    joint: right_gripper_joint
</span></span><span class="line"><span class="cl">    pid: {p: 1.0, i: 0.00, d: 0.0}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4创建控制启动文件">（4）创建控制启动文件
</h3><p>初始化机器人手臂rrbot的最佳方法是生成用于将参数加载至参数服务器的启动文件，并通过该文件启动所有的ros_control控制器。配置文件YAML文件对控制器进行设置,rosparam声明将控制器设置加载至参数服务器。然后control_spawner节点使用controller_manager包为rrbot生成五个控制器。此外还将为robot_state_publisher启动另一个节点。</p>
<p><strong>~/catkin_ws/src/ros_robotics/launch/rrbot_control.launch:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;launch&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- Load joint controller configurations from YAML file to parameter server --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;rosparam</span> <span class="na">file=</span><span class="s">&#34;$(find ros_robotics)/config/rrbot_control.yaml&#34;</span> <span class="na">command=</span><span class="s">&#34;load&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- load the controllers --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&#34;control_spawner&#34;</span> <span class="na">pkg=</span><span class="s">&#34;controller_manager&#34;</span> <span class="na">type=</span><span class="s">&#34;spawner&#34;</span> <span class="na">respawn=</span><span class="s">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="na">output=</span><span class="s">&#34;screen&#34;</span> <span class="na">ns=</span><span class="s">&#34;/rrbot&#34;</span> <span class="na">args=</span><span class="s">&#34;joint_state_controller
</span></span></span><span class="line"><span class="cl"><span class="s">					  joint_base_mid_position_controller
</span></span></span><span class="line"><span class="cl"><span class="s">					  joint_mid_top_position_controller
</span></span></span><span class="line"><span class="cl"><span class="s">                                          left_gripper_joint_position_controller
</span></span></span><span class="line"><span class="cl"><span class="s">                                          right_gripper_joint_position_controller&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- convert joint states to TF transforms for rviz, etc --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&#34;robot_state_publisher&#34;</span> <span class="na">pkg=</span><span class="s">&#34;robot_state_publisher&#34;</span> <span class="na">type=</span><span class="s">&#34;robot_state_publisher&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="na">respawn=</span><span class="s">&#34;false&#34;</span> <span class="na">output=</span><span class="s">&#34;screen&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;remap</span> <span class="na">from=</span><span class="s">&#34;/joint_states&#34;</span> <span class="na">to=</span><span class="s">&#34;/rrbot/joint_states&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/node&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/launch&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在节点启动之后，joint_state_controller开始发布通过JointState话题rrbot所有的非固定关节的状态。robot_state_publisher订阅JointState消息并发布机器人的变换信息到tf变换库中。其他关节的位置控制器分别对相应的旋转副关节进行控制。</p>
<p><strong>在gazebo下启动rrbot：</strong> <code>$ roslaunch ros_robotics rrbot_gazebo.launch</code></p>
<p>当在gazebo中看到rrbot时，打开第二个终端，并使用以下命令<strong>启动控制器</strong></p>
<p><code>$ roslaunch ros_robotics rrbot_control.launch</code></p>
<p>控制启动文件中使用了controller_manager和robot_state_publisher功能包，需要将它们的<strong>依赖添加</strong>到ros_robotics功能包的package.xml文件中。在相应的依赖后，需要添加以下声明：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;exec_depend&gt;</span>controller_manager<span class="nt">&lt;/exec_depend&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;exec_depend&gt;</span>robot_state_publisher<span class="nt">&lt;/exec_depend&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="采用ros命令行控制机器人手臂">采用ROS命令行控制机器人手臂
</h2><p>通过第三个终端窗口发送命令来对机器人手臂rrbot进行控制</p>
<p><strong>（相对于中间的连接杆）把顶部的连接杆移动到1.57弧度（90°）的位置</strong></p>
<p><code>$ rostopic pub -1 /rrbot/joint_mid_top_position_controller/command std_msgs/Float64 &quot;data: 1.57&quot;</code></p>
<p>由于受到环境重力以及控制器执行精度的影响，可能并非达到90°的位置，适当进行PID增益调节，能够提高执行的精确度。</p>
<p>持续发送一下两条命令，可以将左右两个抓手从中心位置打开至-0.5弧度的位置：
<code>$ rostopic pub -1 /rrbot/right_gripper_joint_position_controller/command std_msgs/Float64 &quot;data: -0.5&quot;;rostopic pub -1 /rrbot/left_gripper_joint_position_controller/command std_msgs/Float64 &quot;data: 1.57&quot;</code></p>
<h2 id="采用rqt控制机器人手臂">采用rqt控制机器人手臂
</h2><p><strong>启动rqt</strong></p>
<p><code>$ rosrun rqt_gui rqt_gui</code>  或 <code>$ rqt</code></p>
<p><strong>Plugins|Topic|Message Publiser</strong>：添加/rrbot/joint_base_mid_position_controller/command，/rrbot/joint_mid_top_position_controller/command到主界面，修改表达式发布消息。</p>
<p>**Plugins|Visualization|Plot:**joint_xxx_position_controller/command/data或者joint_xxx_position_controller/state/error绘制在屏幕上,误差图可视化的形式显示。</p>
<p><strong>Plugins|Configuration|Dynamic Reconfigre</strong>:Expand all,为任意关节控制器选择pid，对参数进行动态调整，从而调整控制器的性能参数。</p>
<h1 id="第六章-机器人手臂摇摆的关节控制-baxter">第六章 机器人手臂摇摆的关节控制-Baxter
</h1><p>每个手臂都具有七个自由度
<strong>Baxter更多技术规格参数</strong>，可见：
<a class="link" href="http://www.rethinkrobotics.com/baxter/tech-specs/"  target="_blank" rel="noopener"
    >http://www.rethinkrobotics.com/baxter/tech-specs/</a>
<a class="link" href="http://sdk.rethinkrobotics.com/wiki/Hardware_Specifications"  target="_blank" rel="noopener"
    >http://sdk.rethinkrobotics.com/wiki/Hardware_Specifications</a>
<a class="link" href="http://www.active8robots.com/wp-content/uploads/BaxterHardware-Specifications-Architecture-Datasheet.pdf"  target="_blank" rel="noopener"
    >http://www.active8robots.com/wp-content/uploads/BaxterHardware-Specifications-Architecture-Datasheet.pdf</a>
<strong>机器人上进行配置和代码执行</strong><a class="link" href="http://sdk.rethinkrobotics.com/wiki/SSH"  target="_blank" rel="noopener"
    >http://sdk.rethinkrobotics.com/wiki/SSH</a>
<strong>演示视频</strong><a class="link" href="http://sdk.rethinkrobotics.com/wiki/Customer_Videos"  target="_blank" rel="noopener"
    >http://sdk.rethinkrobotics.com/wiki/Customer_Videos</a>
<strong>研究论文</strong><a class="link" href="http://sdk.rethinkrobotics.com/wiki/Published_Work"  target="_blank" rel="noopener"
    >http://sdk.rethinkrobotics.com/wiki/Published_Work</a>
<strong>Baxter模拟器的ROS功能包和API更多细节性内容</strong>
<a class="link" href="http://sdk.rethinkrobotics.com/wiki/Simulator_Architecture"  target="_blank" rel="noopener"
    >http://sdk.rethinkrobotics.com/wiki/Simulator_Architecture</a>
<a class="link" href="http://sdk.rethinkrobotics.com/wiki/Baxter_Simulator"  target="_blank" rel="noopener"
    >http://sdk.rethinkrobotics.com/wiki/Baxter_Simulator</a>
<a class="link" href="http://sdk.rethinkrobotics.com/wiki/API_Reference#tab.3DSimulator_API"  target="_blank" rel="noopener"
    >http://sdk.rethinkrobotics.com/wiki/API_Reference#tab.3DSimulator_API</a>
<a class="link" href="https://github.com/RethinkRobotics/baxter_simulator"  target="_blank" rel="noopener"
    >https://github.com/RethinkRobotics/baxter_simulator</a></p>
<h2 id="下载baxter软件">下载Baxter软件
</h2><h3 id="安装baxter-sdk软件">安装Baxter SDK软件
</h3><p>SDK下载安装到工作站计算机的ROS的catkin工作空间
<a class="link" href="http://sdk.rethinkrobotics.com/wiki/Workstation_Setup"  target="_blank" rel="noopener"
    >http://sdk.rethinkrobotics.com/wiki/Workstation_Setup</a></p>
<p>参考
<a class="link" href="https://blog.csdn.net/weixin_43731206/article/details/114584436#commentBox"  target="_blank" rel="noopener"
    >https://blog.csdn.net/weixin_43731206/article/details/114584436#commentBox</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">安装Baxter SDK依赖
</span></span><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install git python-argparse python3-wstool python3-vcstools python3-rosdep ros-noetic-control-msgs ros-noetic-joystick-drivers
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">wstool工具检查
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ~/baxter_ws/src
</span></span><span class="line"><span class="cl">wstool init
</span></span><span class="line"><span class="cl">sudo wstool merge https://raw.githubusercontent.com/RethinkRobotics/baxter/master/baxter_sdk.rosinstall
</span></span><span class="line"><span class="cl">wstool update
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">(</span>修改github hosts
</span></span><span class="line"><span class="cl">sudo vim /etc/hosts
</span></span><span class="line"><span class="cl">199.232.28.133 raw.githubusercontent.com<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> ~/baxter_ws
</span></span><span class="line"><span class="cl">$ catkin_make
</span></span><span class="line"><span class="cl">$ catkin_make install
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="安装baxter模拟器">安装Baxter模拟器
</h3><p><a class="link" href="http://sdk.rethinkrobotics.com/wiki/Simulator_Installation"  target="_blank" rel="noopener"
    >http://sdk.rethinkrobotics.com/wiki/Simulator_Installation</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install gazebo2 ros-indigo-qt-build ros-indigo-driver-common ros-indigo-gazebo-ros-control ros-indigo-gazebo-ros-pkgs ros-indigo-ros-control ros-indigo-control-toolbox ros-indigo-realtime-tools ros-indigo-ros-controllers ros-indigo-xacro python-wstool ros-indigo-tf-conversions ros-indigo-kdl-parser<span class="o">(</span>官网未修改，改为noetic<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ~/baxter_ws/src
</span></span><span class="line"><span class="cl">wstool init
</span></span><span class="line"><span class="cl">sudo wstool merge https://raw.githubusercontent.com/RethinkRobotics/baxter_simulator/noetic_devel/baxter_simulator.rosinstall
</span></span><span class="line"><span class="cl">wstool update
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ~/baxter_ws
</span></span><span class="line"><span class="cl">catkin_make
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="配置baxter-shell">配置Baxter shell
</h3><p>SDK需要通过baxter.sh脚本建立机器人与工作站计算机之间的连接
模拟器需要使用baxter.sh脚本建立一种模拟模式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">复制到baxter_ws目录下，权限修改为允许所有用户运行
</span></span><span class="line"><span class="cl">cp ~/baxter_ws/src/baxter/baxter.sh ~/baxter_ws
</span></span><span class="line"><span class="cl">chmod +x baxter.sh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">打开baxter.sh文件，将your_ip的值更改为工作站计算机的IP地址，修改ros_version变量
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="安装moveit-">安装MoveIt ！
</h3><p><a class="link" href="http://sdk.rethin-krobotics.com/wiki/MoveIt_Tutorial"  target="_blank" rel="noopener"
    >http://sdk.rethin-krobotics.com/wiki/MoveIt_Tutorial</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ~/baxter_ws/src
</span></span><span class="line"><span class="cl">git clone https://github.com/ros.planning/moveit_robots.git
</span></span><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install ros-noetic-moveit
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ~/baxter_ws
</span></span><span class="line"><span class="cl">catkin_make
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="在gazebo中启动baxter模拟器">在Gazebo中启动Baxter模拟器
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">启动Baxter模拟器
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ~/baxter_ws
</span></span><span class="line"><span class="cl">./baxter.sh sim
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">检查ROS环境
</span></span><span class="line"><span class="cl">env <span class="p">|</span> grep ROS
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">启动控制器，开始模拟操作
</span></span><span class="line"><span class="cl">roslaunch baxter_gazebo baxter_world.launch
</span></span><span class="line"><span class="cl"><span class="o">(</span>gazebo死机 移除所有gezebo进程 killall gzserver<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>故障说明
<a class="link" href="http://sdk.rethinkrobotics.com/wiki/Troubleshooting"  target="_blank" rel="noopener"
    >http://sdk.rethinkrobotics.com/wiki/Troubleshooting</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">第二个终端
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ~/baxter_ws
</span></span><span class="line"><span class="cl">./baxter.sh sim
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">确认状态
</span></span><span class="line"><span class="cl">rosrun baxter_tools enable_robot.py -s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">使能Baxter
</span></span><span class="line"><span class="cl">rosrun baxter_tools enable_robot.py -e
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">确认状态
</span></span><span class="line"><span class="cl">rosrun baxter_tools enable_robot.py -s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">使能机器人，将手臂设置为一个已知的位置
</span></span><span class="line"><span class="cl">rosrun baxter_tools tuck_arms.py -u
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>样例</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">在模拟的机器人头部显示屏显示一张图片
</span></span><span class="line"><span class="cl">rosrun baxter_examples xdisplay_image.py --file<span class="o">=</span><span class="sb">`</span>rospack find baxter_examples<span class="sb">`</span>/share/images/baxterworking.png
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">控制Baxter的头部上下或者左右运动
</span></span><span class="line"><span class="cl">rosrun baxter_examples head_wobbler.py 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1.手臂展开，Baxter到达闭合位置
</span></span><span class="line"><span class="cl">rosrun baxter_tools tuck_arms.py -u
</span></span><span class="line"><span class="cl">参考http://sdk.rethinkrobotics.com/wiki/Tuck_Arms_Tool
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.手臂摇摆运动
</span></span><span class="line"><span class="cl">rosrun baxter_examples joint_velocity_wobbler.py
</span></span><span class="line"><span class="cl">参考http://sdk.rethinkrobotics.com/wiki/Wobbler_Example
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.键盘控制手臂和抓手
</span></span><span class="line"><span class="cl">rosrun baxter_examples joint_position_keyboard.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.使用游戏手柄控制手臂和抓手
</span></span><span class="line"><span class="cl">joint_position_joystick程序使用源自joy功能包的ROS驱动程序
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">检查手柄驱动功能包joy的安装情况
</span></span><span class="line"><span class="cl">rospack find joy
</span></span><span class="line"><span class="cl">可使用以下命令安装
</span></span><span class="line"><span class="cl">sudo apt-get install ros-noetic-joystick-drivers
</span></span><span class="line"><span class="cl">PS3手柄安装ps3joy功能包 参考http://wiki.ros.org/ps3joy/Tutorials/PairingJoystickAndBluetoothDongle
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">启动joint_position_joystick程序，需要指定手柄类型<span class="o">(</span>xbox/logitech/ps3<span class="o">)</span>
</span></span><span class="line"><span class="cl">roslaunch baxter_examples joint_position_joystick.launch joystick:<span class="o">=</span>&lt;joystick_type&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5.使用Python脚本控制手臂
</span></span><span class="line"><span class="cl">python home_arms.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">6.记录和重演手臂的运动
</span></span><span class="line"><span class="cl">rosrun baxter_examples joint_recorder.py -f armRoutine
</span></span><span class="line"><span class="cl">armRoutine为文件名
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">回放
</span></span><span class="line"><span class="cl">rosrun baxter_examples joint_position_file_playback.py -f armRoutine
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>home_arms.py</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">Script to return Baxter&#39;s arms to a &#34;home&#34; position
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># rospy - ROS Python API</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">rospy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># baxter_interface - Baxter Python API</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">baxter_interface</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># initialize our ROS node, registering it with the Master</span>
</span></span><span class="line"><span class="cl"><span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;Home_Arms&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># create instances of baxter_interface&#39;s Limb class</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_right</span> <span class="o">=</span> <span class="n">baxter_interface</span><span class="o">.</span><span class="n">Limb</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_left</span> <span class="o">=</span> <span class="n">baxter_interface</span><span class="o">.</span><span class="n">Limb</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># store the home position of the arms</span>
</span></span><span class="line"><span class="cl"><span class="n">home_right</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;right_s0&#39;</span><span class="p">:</span> <span class="mf">0.08</span><span class="p">,</span> <span class="s1">&#39;right_s1&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.00</span><span class="p">,</span> <span class="s1">&#39;right_w0&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.67</span><span class="p">,</span> <span class="s1">&#39;right_w1&#39;</span><span class="p">:</span> <span class="mf">1.03</span><span class="p">,</span> <span class="s1">&#39;right_w2&#39;</span><span class="p">:</span> <span class="mf">0.50</span><span class="p">,</span> <span class="s1">&#39;right_e0&#39;</span><span class="p">:</span> <span class="mf">1.18</span><span class="p">,</span> <span class="s1">&#39;right_e1&#39;</span><span class="p">:</span> <span class="mf">1.94</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">home_left</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;left_s0&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.08</span><span class="p">,</span> <span class="s1">&#39;left_s1&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.00</span><span class="p">,</span> <span class="s1">&#39;left_w0&#39;</span><span class="p">:</span> <span class="mf">0.67</span><span class="p">,</span> <span class="s1">&#39;left_w1&#39;</span><span class="p">:</span> <span class="mf">1.03</span><span class="p">,</span> <span class="s1">&#39;left_w2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.50</span><span class="p">,</span> <span class="s1">&#39;left_e0&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.18</span><span class="p">,</span> <span class="s1">&#39;left_e1&#39;</span><span class="p">:</span> <span class="mf">1.94</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># move both arms to home position</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_right</span><span class="o">.</span><span class="n">move_to_joint_positions</span><span class="p">(</span><span class="n">home_right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_left</span><span class="o">.</span><span class="n">move_to_joint_positions</span><span class="p">(</span><span class="n">home_left</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">quit</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="baxter手臂与正向运动">Baxter手臂与正向运动
</h2><h3 id="关节与关节状态发布器">关节与关节状态发布器
</h3><p>有关话题/robot/joint_states</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ~/baxter_ws
</span></span><span class="line"><span class="cl">./baxter.sh sim
</span></span><span class="line"><span class="cl">roslaunch baxter_gazebo baxter_world.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ~/baxter_ws
</span></span><span class="line"><span class="cl">./baxter.sh sim
</span></span><span class="line"><span class="cl">rosrun baxter_tools enable_robot.py -e
</span></span><span class="line"><span class="cl">将Baxter手臂置于home位置
</span></span><span class="line"><span class="cl">python home_arms.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">显示相关信息
</span></span><span class="line"><span class="cl">rostopic <span class="nb">echo</span> /robot/joint_states -nl
</span></span><span class="line"><span class="cl">显示左侧手臂末端的位置和朝向
</span></span><span class="line"><span class="cl"> rostopic <span class="nb">echo</span> /robot/limb/left/endpoint_state/pose -n1
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="理解tf">理解tf
</h3><p><strong>控制Baxter手臂移动到0角度位置的程序</strong>
<strong>arms_to_zero_angles.py</strong>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python   # arms_to_zero_angles.py </span>
</span></span><span class="line"><span class="cl"><span class="c1">#   </span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">Script to return Baxter&#39;s arms to a &#34;zero angles&#34; position  
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># rospy - ROS Python API</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">rospy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># baxter_interface - Baxter Python API</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">baxter_interface</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># initialize our ROS node, registering it with the Master</span>
</span></span><span class="line"><span class="cl"><span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;Zero_Arms&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># create instances of baxter_interface&#39;s Limb class</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_right</span> <span class="o">=</span> <span class="n">baxter_interface</span><span class="o">.</span><span class="n">Limb</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_left</span> <span class="o">=</span> <span class="n">baxter_interface</span><span class="o">.</span><span class="n">Limb</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># store the zero position of the arms</span>
</span></span><span class="line"><span class="cl"><span class="n">zero_right</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;right_s0&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;right_s1&#39;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span> <span class="s1">&#39;right_w0&#39;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span> <span class="s1">&#39;right_w1&#39;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span> <span class="s1">&#39;right_w2&#39;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span> <span class="s1">&#39;right_e0&#39;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span> <span class="s1">&#39;right_e1&#39;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">zero_left</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;left_s0&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;left_s1&#39;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span> <span class="s1">&#39;left_w0&#39;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span> <span class="s1">&#39;left_w1&#39;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span> <span class="s1">&#39;left_w2&#39;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span> <span class="s1">&#39;left_e0&#39;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span> <span class="s1">&#39;left_e1&#39;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># move both arms to home position</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_right</span><span class="o">.</span><span class="n">move_to_joint_positions</span><span class="p">(</span><span class="n">zero_right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_left</span><span class="o">.</span><span class="n">move_to_joint_positions</span><span class="p">(</span><span class="n">zero_left</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">quit</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python编译成可执行
</span></span><span class="line"><span class="cl">chmod +x arms_to_zero_angles.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">运行脚本
</span></span><span class="line"><span class="cl">python arms_to_zero_angles.py
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="直接指定关节组件角度">直接指定关节组件角度
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">rostopic pub -r <span class="m">10</span> /robot/limb/left/joint_command baxter_core_msgs/Jointcommand <span class="s2">&#34;{mode:1, command: [0.0, 0.0, 0.0,  0.0], name: [&#39;left_w1&#39;, &#39;left_e1&#39;, &#39;left_s0&#39;, &#39;left_s1&#39;]}&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>参考http://sdk.rethinkrobotics.com/wiki/Arm_Control_Modes</p>
<h3 id="查看机器人元素的tf树">查看机器人元素的tf树
</h3><p>启动view_frames
<code>rosrun tf view_frames</code>
查看<code>evince frames.pdf</code>
参考http://wiki.ros.org/tf/Tutorials/Introduction%20to%20tf</p>
<h2 id="moveit-简介">MoveIt 简介
</h2><p>用户手册 <a class="link" href="http://sdk.rethinkrobotics.com/wiki/MoveIt_Tutorial"  target="_blank" rel="noopener"
    >http://sdk.rethinkrobotics.com/wiki/MoveIt_Tutorial</a>
对MoveIt!的使用进行演示</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ~/baxter_ws
</span></span><span class="line"><span class="cl">./baxter.sh sim
</span></span><span class="line"><span class="cl">roslaunch baxter_gazebo baxter_world.launch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">打开手臂，运行py脚本启动joint_trajectory_action_server
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ~/baxter_ws
</span></span><span class="line"><span class="cl">./baxter.sh sim
</span></span><span class="line"><span class="cl">rosrun baxter_tools tuck_arms.py -u
</span></span><span class="line"><span class="cl">rosrun baxter_interface joint_trajectory_action_server.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">启动moveit
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ~/baxter_ws
</span></span><span class="line"><span class="cl">./baxter.sh sim
</span></span><span class="line"><span class="cl">roslaunch baxter_moveit_config baxter_grippers.launch
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="控制真实的baxter机器人">控制真实的Baxter机器人
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">到达航路点
</span></span><span class="line"><span class="cl">rosrun baxter_examples joint_position_waypoint.py -l &lt;left or right&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">控制关节的力矩弹簧
</span></span><span class="line"><span class="cl">rosrun baxter_examples joint_torque_springs.py -l &lt;left or right&gt;
</span></span><span class="line"><span class="cl">rqt对关节力矩进行修改和配置
</span></span><span class="line"><span class="cl">rosrun rqt_reconfigure rqt_reconfigue
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">控制关节速度
</span></span><span class="line"><span class="cl">rosrun baxter_examples joint_velocity_puppet.py -l &lt;left or right&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>其他示例参考 <a class="link" href="http://sdk.rethinkrobotics.com/wiki/Examples"  target="_blank" rel="noopener"
    >http://sdk.rethinkrobotics.com/wiki/Examples</a></p>
<h3 id="反向运动">反向运动
</h3><p>正向运动——计算出抓手在任意时刻的位置
反向运动——控制抓手运动到指定位置和朝向，需要计算关节的角度
参考 <a class="link" href="http://sdk.rethinkrobotics.com/wiki/IK_Service_Example"  target="_blank" rel="noopener"
    >http://sdk.rethinkrobotics.com/wiki/IK_Service_Example</a>
<a class="link" href="http://sdk.rethinkrobotics.com/wiki/IK_Service_-_Code"  target="_blank" rel="noopener"
    >http://sdk.rethinkrobotics.com/wiki/IK_Service_-_Code</a>_	Walkthrough</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">运行py脚本得到运行到固定位置时左侧手臂有关关节的角度值
</span></span><span class="line"><span class="cl">rosrun baxter_examples ik_service_client.py -l left
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>利用反向运动移动Baxter的手臂</strong>（真实baxter）
1.启动Baxter，展开手臂，此时位于home位置
2.记录左侧手臂终点状态的位置和朝向
3.将Baxter的左侧手臂移动到任意位置
4.baxter_examples功能包里的ik_service_client.py，输入展开后的左侧手臂位置和朝向，以不同的名字保存在catkin_workspace下
5.执行脚本，获取左侧手臂的关节角度
6.将角度输入到修改后的home_arms.py中，执行该脚本
7.记录新终点位置和朝向，并与步骤2中为的原始值进行对比</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">1.
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ~/baxter_ws
</span></span><span class="line"><span class="cl">./baxter.sh
</span></span><span class="line"><span class="cl">roslaunch baxter_tools tuck_arms.py -u
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.
</span></span><span class="line"><span class="cl">rostopic <span class="nb">echo</span> /robot/limb/left/endpoint_state/pose -n1 -w4
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.
</span></span><span class="line"><span class="cl">roscd baxter_examples/scripts
</span></span><span class="line"><span class="cl">找到要修改的脚本，以新名字保存
</span></span><span class="line"><span class="cl">chmod +x ik_home_arms_ch6RealBaxter.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5.运行相应的例子，获取将Baxter左侧手臂移动到展开位置的关节角度
</span></span><span class="line"><span class="cl">python ik_home_arms_ch6RealBaxter.py -l left
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">6.使用编辑过的py脚本home_arms.py得到的角度来控制Baxter手臂的移动，改变左侧手臂关节的角度值，以新文件命名
</span></span><span class="line"><span class="cl">chmod +x MoveLeftArmToHome.py
</span></span><span class="line"><span class="cl">python MoveLeftArmToHome.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">7.
</span></span><span class="line"><span class="cl">rostopic <span class="nb">echo</span> /robot/limb/left/endpoint_state/pose -n1 -w4
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>MoveLeftArmToHome.py</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">Script to return Baxter&#39;s arms to a &#34;home&#34; position
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># rospy - ROS Python API</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">rospy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># baxter_interface - Baxter Python API</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">baxter_interface</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># initialize our ROS node, registering it with the Master</span>
</span></span><span class="line"><span class="cl"><span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;Home_Arms&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># create instances of baxter_interface&#39;s Limb class</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_right</span> <span class="o">=</span> <span class="n">baxter_interface</span><span class="o">.</span><span class="n">Limb</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_left</span> <span class="o">=</span> <span class="n">baxter_interface</span><span class="o">.</span><span class="n">Limb</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># store the home position of the arms</span>
</span></span><span class="line"><span class="cl"><span class="n">home_right</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;right_s0&#39;</span><span class="p">:</span> <span class="mf">0.08</span><span class="p">,</span> <span class="s1">&#39;right_s1&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.00</span><span class="p">,</span> <span class="s1">&#39;right_w0&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.67</span><span class="p">,</span> <span class="s1">&#39;right_w1&#39;</span><span class="p">:</span> <span class="mf">1.03</span><span class="p">,</span> <span class="s1">&#39;right_w2&#39;</span><span class="p">:</span> <span class="mf">0.50</span><span class="p">,</span> <span class="s1">&#39;right_e0&#39;</span><span class="p">:</span> <span class="mf">1.18</span><span class="p">,</span> <span class="s1">&#39;right_e1&#39;</span><span class="p">:</span> <span class="mf">1.94</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">home_left</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;left_w0&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.8582664616409326</span><span class="p">,</span> <span class="s1">&#39;left_w1&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.460468102595922</span><span class="p">,</span> <span class="s1">&#39;left_w2&#39;</span><span class="p">:</span> <span class="mf">2.2756459061545797</span><span class="p">,</span> <span class="s1">&#39;left_e0&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.6081637990992477</span><span class="p">,</span> <span class="s1">&#39;left_e1&#39;</span><span class="p">:</span> <span class="mf">1.9645288022495901</span><span class="p">,</span> <span class="s1">&#39;left_s0&#39;</span><span class="p">:</span> <span class="mf">0.044896665837355125</span><span class="p">,</span> <span class="s1">&#39;left_s1&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.3326492980686455</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># move both arms to home position</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_right</span><span class="o">.</span><span class="n">move_to_joint_positions</span><span class="p">(</span><span class="n">home_right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_left</span><span class="o">.</span><span class="n">move_to_joint_positions</span><span class="p">(</span><span class="n">home_left</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">quit</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ik_home_arms_ch6RealBaxter.py</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python      # ik_home_arms_ch6RealBaxter.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Copyright (c) 2013-2015, Rethink Robotics</span>
</span></span><span class="line"><span class="cl"><span class="c1"># All rights reserved.</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Redistribution and use in source and binary forms, with or without</span>
</span></span><span class="line"><span class="cl"><span class="c1"># modification, are permitted provided that the following conditions are met:</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1. Redistributions of source code must retain the above copyright notice,</span>
</span></span><span class="line"><span class="cl"><span class="c1">#    this list of conditions and the following disclaimer.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2. Redistributions in binary form must reproduce the above copyright</span>
</span></span><span class="line"><span class="cl"><span class="c1">#    notice, this list of conditions and the following disclaimer in the</span>
</span></span><span class="line"><span class="cl"><span class="c1">#    documentation and/or other materials provided with the distribution.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 3. Neither the name of the Rethink Robotics nor the names of its</span>
</span></span><span class="line"><span class="cl"><span class="c1">#    contributors may be used to endorse or promote products derived from</span>
</span></span><span class="line"><span class="cl"><span class="c1">#    this software without specific prior written permission.</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &#34;AS IS&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
</span></span><span class="line"><span class="cl"><span class="c1"># IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span>
</span></span><span class="line"><span class="cl"><span class="c1"># LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
</span></span><span class="line"><span class="cl"><span class="c1"># CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
</span></span><span class="line"><span class="cl"><span class="c1"># SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
</span></span><span class="line"><span class="cl"><span class="c1"># INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
</span></span><span class="line"><span class="cl"><span class="c1"># CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
</span></span><span class="line"><span class="cl"><span class="c1"># POSSIBILITY OF SUCH DAMAGE.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">Baxter RSDK Inverse Kinematics Example
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">argparse</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">struct</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">rospy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">PoseStamped</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">Pose</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">Point</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">Quaternion</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">Header</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">baxter_core_msgs.srv</span> <span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">SolvePositionIK</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">SolvePositionIKRequest</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">ik_test</span><span class="p">(</span><span class="n">limb</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s2">&#34;rsdk_ik_service_client&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ns</span> <span class="o">=</span> <span class="s2">&#34;ExternalTools/&#34;</span> <span class="o">+</span> <span class="n">limb</span> <span class="o">+</span> <span class="s2">&#34;/PositionKinematicsNode/IKService&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">iksvc</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ServiceProxy</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">SolvePositionIK</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ikreq</span> <span class="o">=</span> <span class="n">SolvePositionIKRequest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">hdr</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">stamp</span><span class="o">=</span><span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">frame_id</span><span class="o">=</span><span class="s1">&#39;base&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">poses</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="n">PoseStamped</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">header</span><span class="o">=</span><span class="n">hdr</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">pose</span><span class="o">=</span><span class="n">Pose</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">position</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">x</span><span class="o">=</span><span class="mf">0.57</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">y</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">z</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="n">orientation</span><span class="o">=</span><span class="n">Quaternion</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">x</span><span class="o">=</span><span class="mf">0.13</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">y</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">z</span><span class="o">=</span><span class="mf">0.00</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">w</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="n">PoseStamped</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">header</span><span class="o">=</span><span class="n">hdr</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">pose</span><span class="o">=</span><span class="n">Pose</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">position</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">x</span><span class="o">=</span><span class="mf">0.656982770038</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">y</span><span class="o">=-</span><span class="mf">0.852598021641</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">z</span><span class="o">=</span><span class="mf">0.0388609422173</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="n">orientation</span><span class="o">=</span><span class="n">Quaternion</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">x</span><span class="o">=</span><span class="mf">0.367048116303</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">y</span><span class="o">=</span><span class="mf">0.885911751787</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">z</span><span class="o">=-</span><span class="mf">0.108908281936</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">w</span><span class="o">=</span><span class="mf">0.261868353356</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ikreq</span><span class="o">.</span><span class="n">pose_stamp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poses</span><span class="p">[</span><span class="n">limb</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">resp</span> <span class="o">=</span> <span class="n">iksvc</span><span class="p">(</span><span class="n">ikreq</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">ServiceException</span><span class="p">,</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSException</span><span class="p">),</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">logerr</span><span class="p">(</span><span class="s2">&#34;Service call failed: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Check if result valid, and type of seed ultimately used to get solution</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># convert rospy&#39;s string representation of uint8[]&#39;s to int&#39;s</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp_seeds</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;</span><span class="si">%d</span><span class="s1">B&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">result_type</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                               <span class="n">resp</span><span class="o">.</span><span class="n">result_type</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">resp_seeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">resp</span><span class="o">.</span><span class="n">RESULT_INVALID</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">seed_str</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ikreq</span><span class="o">.</span><span class="n">SEED_USER</span><span class="p">:</span> <span class="s1">&#39;User Provided Seed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ikreq</span><span class="o">.</span><span class="n">SEED_CURRENT</span><span class="p">:</span> <span class="s1">&#39;Current Joint Angles&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ikreq</span><span class="o">.</span><span class="n">SEED_NS_MAP</span><span class="p">:</span> <span class="s1">&#39;Nullspace Setpoints&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">resp_seeds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;SUCCESS - Valid Joint Solution Found from Seed Type: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="n">seed_str</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Format solution into Limb API-compatible dictionary</span>
</span></span><span class="line"><span class="cl">        <span class="n">limb_joints</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">IK Joint Solution:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">limb_joints</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;------------------&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;Response Message:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">resp</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;INVALID POSE - No Valid Joint Solution Found.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;RSDK Inverse Kinematics Example
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    A simple example of using the Rethink Inverse Kinematics
</span></span></span><span class="line"><span class="cl"><span class="s2">    Service which returns the joint angles and validity for
</span></span></span><span class="line"><span class="cl"><span class="s2">    a requested Cartesian Pose.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Run this example, passing the *limb* to test, and the
</span></span></span><span class="line"><span class="cl"><span class="s2">    example will call the Service with a sample Cartesian
</span></span></span><span class="line"><span class="cl"><span class="s2">    Pose, pre-defined in the example code, printing the
</span></span></span><span class="line"><span class="cl"><span class="s2">    response of whether a valid joint solution was found,
</span></span></span><span class="line"><span class="cl"><span class="s2">    and if so, the corresponding joint angles.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">arg_fmt</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">formatter_class</span><span class="o">=</span><span class="n">arg_fmt</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                     <span class="n">description</span><span class="o">=</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;-l&#39;</span><span class="p">,</span> <span class="s1">&#39;--limb&#39;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">],</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">help</span><span class="o">=</span><span class="s2">&#34;the limb to test&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">myargv</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ik_test</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">limb</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>home_arms.py</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">Script to return Baxter&#39;s arms to a &#34;home&#34; position
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># rospy - ROS Python API</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">rospy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># baxter_interface - Baxter Python API</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">baxter_interface</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># initialize our ROS node, registering it with the Master</span>
</span></span><span class="line"><span class="cl"><span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;Home_Arms&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># create instances of baxter_interface&#39;s Limb class</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_right</span> <span class="o">=</span> <span class="n">baxter_interface</span><span class="o">.</span><span class="n">Limb</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_left</span> <span class="o">=</span> <span class="n">baxter_interface</span><span class="o">.</span><span class="n">Limb</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># store the home position of the arms</span>
</span></span><span class="line"><span class="cl"><span class="n">home_right</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;right_s0&#39;</span><span class="p">:</span> <span class="mf">0.08</span><span class="p">,</span> <span class="s1">&#39;right_s1&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.00</span><span class="p">,</span> <span class="s1">&#39;right_w0&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.67</span><span class="p">,</span> <span class="s1">&#39;right_w1&#39;</span><span class="p">:</span> <span class="mf">1.03</span><span class="p">,</span> <span class="s1">&#39;right_w2&#39;</span><span class="p">:</span> <span class="mf">0.50</span><span class="p">,</span> <span class="s1">&#39;right_e0&#39;</span><span class="p">:</span> <span class="mf">1.18</span><span class="p">,</span> <span class="s1">&#39;right_e1&#39;</span><span class="p">:</span> <span class="mf">1.94</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">home_left</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;left_s0&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.08</span><span class="p">,</span> <span class="s1">&#39;left_s1&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.00</span><span class="p">,</span> <span class="s1">&#39;left_w0&#39;</span><span class="p">:</span> <span class="mf">0.67</span><span class="p">,</span> <span class="s1">&#39;left_w1&#39;</span><span class="p">:</span> <span class="mf">1.03</span><span class="p">,</span> <span class="s1">&#39;left_w2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.50</span><span class="p">,</span> <span class="s1">&#39;left_e0&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.18</span><span class="p">,</span> <span class="s1">&#39;left_e1&#39;</span><span class="p">:</span> <span class="mf">1.94</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># move both arms to home position</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_right</span><span class="o">.</span><span class="n">move_to_joint_positions</span><span class="p">(</span><span class="n">home_right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">limb_left</span><span class="o">.</span><span class="n">move_to_joint_positions</span><span class="p">(</span><span class="n">home_left</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">quit</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="使用状态机实现ymca">使用状态机实现YMCA
</h3><p>SMACH-基于python的状态机结构库
参考http://wiki.ros.org/smach
<a class="link" href="http://wiki.ros.org/smach/Tutorials"  target="_blank" rel="noopener"
    >http://wiki.ros.org/smach/Tutorials</a>
舞出YMCA以及一个中立位置，实现程序为YMCAStateMach.py
<strong>YMCAStateMach.py</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Using the ROS SMACH package, this Python script creates five states </span>
</span></span><span class="line"><span class="cl"><span class="c1"># corresponding to Baxter&#39;s arm poses for each letter Y, M, C, A and a </span>
</span></span><span class="line"><span class="cl"><span class="c1"># fifth state for a neutral pose. When one pose of the arms completes, </span>
</span></span><span class="line"><span class="cl"><span class="c1"># the state will successfully complete and the next state will begin. </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Refer to ROS Robotics By Example 2nd edition for a detailed</span>
</span></span><span class="line"><span class="cl"><span class="c1"># explanation of this software.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">rospy</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">smach</span> <span class="kn">import</span> <span class="n">State</span><span class="p">,</span><span class="n">StateMachine</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">MoveControl</span> <span class="kn">import</span> <span class="n">Baxter_Arms</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Y</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">State</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">letter_y</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;letter&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;left&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;right&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                       <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">                         <span class="c1">#DoF Key [s0,s1,e0,e1,w0,w1,w2]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userdata</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s1">&#39;Give me a Y!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">barms</span><span class="o">.</span><span class="n">supervised_move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">letter_y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;success&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">M</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">State</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">letter_m</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;letter&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;left&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.50</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.052</span><span class="p">,</span>  <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.094</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;right&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.50</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.052</span><span class="p">,</span>  <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.094</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                       <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">                         <span class="c1">#DoF Key [s0,s1,e0,e1,w0,w1,w2]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userdata</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s1">&#39;Give me a M!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">barms</span><span class="o">.</span><span class="n">supervised_move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">letter_m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;success&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">State</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">letter_c</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;letter&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;left&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.80</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.052</span><span class="p">,</span>  <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.50</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;right&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.50</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.052</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                       <span class="p">}</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">                         <span class="c1">#DoF Key [s0,s1,e0,e1,w0,w1,w2]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userdata</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s1">&#39;Give me a C!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">barms</span><span class="o">.</span><span class="n">supervised_move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">letter_c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;success&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">State</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">letter_a</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;letter&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;left&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.50</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;right&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="o">-</span><span class="mf">0.50</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                       <span class="p">}</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">                         <span class="c1">#DoF Key [s0,s1,e0,e1,w0,w1,w2]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userdata</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s1">&#39;Give me an A!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">barms</span><span class="o">.</span><span class="n">supervised_move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">letter_a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;success&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Zero</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">State</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">zero</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;letter&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;left&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;right&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span>  <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                       <span class="p">}</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">                         <span class="c1">#DoF Key [s0,s1,e0,e1,w0,w1,w2]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userdata</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s1">&#39;Ta-da&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">barms</span><span class="o">.</span><span class="n">supervised_move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;success&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">barms</span> <span class="o">=</span> <span class="n">Baxter_Arms</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">rospy</span><span class="o">.</span><span class="n">on_shutdown</span><span class="p">(</span><span class="n">barms</span><span class="o">.</span><span class="n">clean_shutdown</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">sm</span> <span class="o">=</span> <span class="n">StateMachine</span><span class="p">(</span><span class="n">outcomes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">sm</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">StateMachine</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">Y</span><span class="p">(),</span> <span class="n">transitions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span><span class="s1">&#39;M&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">StateMachine</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">M</span><span class="p">(),</span> <span class="n">transitions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span><span class="s1">&#39;C&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">StateMachine</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">C</span><span class="p">(),</span> <span class="n">transitions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span><span class="s1">&#39;A&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">StateMachine</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">A</span><span class="p">(),</span> <span class="n">transitions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span><span class="s1">&#39;ZERO&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">StateMachine</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;ZERO&#39;</span><span class="p">,</span> <span class="n">Zero</span><span class="p">(),</span> <span class="n">transitions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span><span class="s1">&#39;success&#39;</span><span class="p">})</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">sm</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>MoveControl.py</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Origional code from Rethink Robotics, Copyright (c) 2013-2015  </span>
</span></span><span class="line"><span class="cl"><span class="c1"># This code has been modified encapsulate Baxter&#39;s arms in a class and </span>
</span></span><span class="line"><span class="cl"><span class="c1"># provide methods to control the arms.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># It works with the YMCAStateMach.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Refer to ROS Robotics By Example 2nd edition for a detailed</span>
</span></span><span class="line"><span class="cl"><span class="c1"># explanation of this software.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">argparse</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">rospy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">Empty</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">Bool</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">baxter_interface</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">baxter_core_msgs.msg</span> <span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">CollisionAvoidanceState</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">baxter_interface</span> <span class="kn">import</span> <span class="n">CHECK_VERSION</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Baxter_Arms</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&#34;Initializing node now... &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s2">&#34;moving_arms&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&#34;Node Initialized. &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_limbs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_arms</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="n">baxter_interface</span><span class="o">.</span><span class="n">Limb</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="n">baxter_interface</span><span class="o">.</span><span class="n">Limb</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_pose_rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mf">20.0</span><span class="p">)</span>  <span class="c1"># Hz</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_pose_threshold</span> <span class="o">=</span> <span class="mf">0.2</span>   <span class="c1"># radians</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_peak_angle</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.6</span>      <span class="c1"># radians</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_arm_state</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                           <span class="s1">&#39;pose&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">                           <span class="s1">&#39;collide&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">                           <span class="s1">&#39;flipped&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                          <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     	  <span class="c1">#Empty positional library that will be fed in and overwritten as arms_pose.</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_joint_moves</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;letter&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                       <span class="s1">&#39;left&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                       <span class="s1">&#39;right&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                       <span class="p">}</span> 
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">                         <span class="c1">#DoF Key [s0,s1,e0,e1,w0,w1,w2]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_collide_lsub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                             <span class="s1">&#39;robot/limb/left/collision_avoidance_state&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                             <span class="n">CollisionAvoidanceState</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                             <span class="bp">self</span><span class="o">.</span><span class="n">_update_collision</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_collide_rsub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                             <span class="s1">&#39;robot/limb/right/collision_avoidance_state&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                             <span class="n">CollisionAvoidanceState</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                             <span class="bp">self</span><span class="o">.</span><span class="n">_update_collision</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_disable_pub</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                 <span class="s1">&#39;robot/limb/left/suppress_collision_avoidance&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                 <span class="n">Empty</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                 <span class="s1">&#39;robot/limb/right/suppress_collision_avoidance&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                 <span class="n">Empty</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_rs</span> <span class="o">=</span> <span class="n">baxter_interface</span><span class="o">.</span><span class="n">RobotEnable</span><span class="p">(</span><span class="n">CHECK_VERSION</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_enable_pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s1">&#39;robot/set_super_enable&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                           <span class="n">Bool</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_update_collision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">limb</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_arm_state</span><span class="p">[</span><span class="s1">&#39;collide&#39;</span><span class="p">][</span><span class="n">limb</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">collision_object</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_check_arm_state</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_check_arm_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Check for goals and behind collision field.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        If s1 joint is over the peak, collision will need to be disabled
</span></span></span><span class="line"><span class="cl"><span class="s2">        to get the arm around the head-arm collision force-field.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">diff_check</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pose_threshold</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">limb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limbs</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">angles</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_arms</span><span class="p">[</span><span class="n">limb</span><span class="p">]</span><span class="o">.</span><span class="n">joint_angle</span><span class="p">(</span><span class="n">joint</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                      <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arms</span><span class="p">[</span><span class="n">limb</span><span class="p">]</span><span class="o">.</span><span class="n">joint_names</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Check if in a goal position</span>
</span></span><span class="line"><span class="cl">            <span class="n">letter_goal</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">diff_check</span><span class="p">,</span> <span class="n">angles</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="bp">self</span><span class="o">.</span><span class="n">_joint_moves</span><span class="p">[</span><span class="s1">&#39;letter&#39;</span><span class="p">][</span><span class="n">limb</span><span class="p">])</span>                      
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">letter_goal</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_arm_state</span><span class="p">[</span><span class="s1">&#39;pose&#39;</span><span class="p">][</span><span class="n">limb</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;letter&#39;</span> 
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_arm_state</span><span class="p">[</span><span class="s1">&#39;pose&#39;</span><span class="p">][</span><span class="n">limb</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Check if shoulder is flipped over peak</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_arm_state</span><span class="p">[</span><span class="s1">&#39;flipped&#39;</span><span class="p">][</span><span class="n">limb</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_arms</span><span class="p">[</span><span class="n">limb</span><span class="p">]</span><span class="o">.</span><span class="n">joint_angle</span><span class="p">(</span><span class="n">limb</span> <span class="o">+</span> <span class="s1">&#39;_s1&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_angle</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_pose</span><span class="p">,</span> <span class="n">disabled</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">disabled</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="n">pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Empty</span><span class="p">())</span> <span class="k">for</span> <span class="n">pub</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disable_pub</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arm_state</span><span class="p">[</span><span class="s1">&#39;pose&#39;</span><span class="p">][</span><span class="n">limb</span><span class="p">]</span> <span class="o">!=</span> <span class="n">goal</span>
</span></span><span class="line"><span class="cl">                   <span class="k">for</span> <span class="n">limb</span><span class="p">,</span> <span class="n">goal</span> <span class="ow">in</span> <span class="n">new_pose</span><span class="o">.</span><span class="n">viewitems</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">               <span class="ow">and</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rs</span><span class="o">.</span><span class="n">state</span><span class="p">()</span><span class="o">.</span><span class="n">enabled</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_enable_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">limb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limbs</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">disabled</span><span class="p">[</span><span class="n">limb</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">_disable_pub</span><span class="p">[</span><span class="n">limb</span><span class="p">]</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Empty</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">limb</span> <span class="ow">in</span> <span class="n">new_pose</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">_arms</span><span class="p">[</span><span class="n">limb</span><span class="p">]</span><span class="o">.</span><span class="n">set_joint_positions</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                                      <span class="bp">self</span><span class="o">.</span><span class="n">_arms</span><span class="p">[</span><span class="n">limb</span><span class="p">]</span><span class="o">.</span><span class="n">joint_names</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                                      <span class="bp">self</span><span class="o">.</span><span class="n">_joint_moves</span><span class="p">[</span><span class="n">new_pose</span><span class="p">[</span><span class="n">limb</span><span class="p">]][</span><span class="n">limb</span><span class="p">])))</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_check_arm_state</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_pose_rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arm_state</span><span class="p">[</span><span class="s1">&#39;collide&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_rs</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#Importing data in the form of arms_pose, origionally paired with YMCAStateMach.py </span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">supervised_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arms_pose</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_joint_moves</span> <span class="o">=</span> <span class="n">arms_pose</span>    <span class="c1"># Updating private variable with new arms_pose</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_check_arm_state</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#Update our starting state to check if arms are posed?</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&#34;Movement in progress.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">suppress</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arm_state</span><span class="p">[</span><span class="s1">&#39;flipped&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">actions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="s1">&#39;letter&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="s1">&#39;letter&#39;</span><span class="p">}</span>    
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_move_to</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="n">suppress</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_done</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">clean_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Handles ROS shutdown (Ctrl-C) safely.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rospy</span><span class="o">.</span><span class="n">logwarn</span><span class="p">(</span><span class="s1">&#39;Aborting: Shutting down safely...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arm_state</span><span class="p">[</span><span class="s1">&#39;collide&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rs</span><span class="o">.</span><span class="n">state</span><span class="p">()</span><span class="o">.</span><span class="n">enabled</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="p">[</span><span class="n">pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Empty</span><span class="p">())</span> <span class="k">for</span> <span class="n">pub</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disable_pub</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_enable_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_pose_rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">barms</span> <span class="o">=</span> <span class="n">Baxter_Arms</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">rospy</span><span class="o">.</span><span class="n">on_shutdown</span><span class="p">(</span><span class="n">barms</span><span class="o">.</span><span class="n">clean_shutdown</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">barms</span><span class="o">.</span><span class="n">supervised_move</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&#34;Finished move.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>YMCAStateMach_for_Sim.py</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Using the ROS SMACH package, this Python script creates five states </span>
</span></span><span class="line"><span class="cl"><span class="c1"># corresponding to Baxter&#39;s arm poses for each letter Y, M, C, A and a </span>
</span></span><span class="line"><span class="cl"><span class="c1"># fifth state for a neutral pose. When one pose of the arms completes, </span>
</span></span><span class="line"><span class="cl"><span class="c1"># the state will successfully complete and the next state will begin. </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Refer to ROS Robotics By Example 2nd edition for a detailed</span>
</span></span><span class="line"><span class="cl"><span class="c1"># explanation of this software.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">rospy</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">smach</span> <span class="kn">import</span> <span class="n">State</span><span class="p">,</span><span class="n">StateMachine</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">MoveControl</span> <span class="kn">import</span> <span class="n">Baxter_Arms</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Y</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">State</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">letter_y</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;letter&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;left&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;right&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                       <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">                         <span class="c1">#DoF Key [s0,s1,e0,e1,w0,w1,w2]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userdata</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s1">&#39;Give me a Y!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">barms</span><span class="o">.</span><span class="n">supervised_move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">letter_y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;success&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">M</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">State</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">letter_m</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;letter&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;left&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.50</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span>  <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.09</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;right&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.50</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.09</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                       <span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">                         <span class="c1">#DoF Key [s0,s1,e0,e1,w0,w1,w2]</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># &#39;left&#39;:  [0.0, -1.50, 1.0, -0.052,  3.0, 2.094, 0.0], original for real Baxter</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># &#39;right&#39;:  [0.0, -1.50, -1.0, -0.052,  -3.0, 2.094, 0.0]  original for real Baxter</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userdata</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s1">&#39;Give me a M!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">barms</span><span class="o">.</span><span class="n">supervised_move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">letter_m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;success&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">State</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">letter_c</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;letter&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;left&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.80</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.052</span><span class="p">,</span>  <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.50</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;right&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.50</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.052</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                       <span class="p">}</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">                         <span class="c1">#DoF Key [s0,s1,e0,e1,w0,w1,w2]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userdata</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s1">&#39;Give me a C!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">barms</span><span class="o">.</span><span class="n">supervised_move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">letter_c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;success&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">State</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">letter_a</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;letter&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;left&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.50</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;right&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="o">-</span><span class="mf">0.50</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                       <span class="p">}</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">                         <span class="c1">#DoF Key [s0,s1,e0,e1,w0,w1,w2]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userdata</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s1">&#39;Give me an A!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">barms</span><span class="o">.</span><span class="n">supervised_move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">letter_a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;success&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Zero</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">State</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">zero</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;letter&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;left&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;right&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span>  <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                       <span class="p">}</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">                         <span class="c1">#DoF Key [s0,s1,e0,e1,w0,w1,w2]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userdata</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s1">&#39;Ta-da&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">barms</span><span class="o">.</span><span class="n">supervised_move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;success&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">barms</span> <span class="o">=</span> <span class="n">Baxter_Arms</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">rospy</span><span class="o">.</span><span class="n">on_shutdown</span><span class="p">(</span><span class="n">barms</span><span class="o">.</span><span class="n">clean_shutdown</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">sm</span> <span class="o">=</span> <span class="n">StateMachine</span><span class="p">(</span><span class="n">outcomes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">sm</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">StateMachine</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">Y</span><span class="p">(),</span> <span class="n">transitions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span><span class="s1">&#39;M&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">StateMachine</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">M</span><span class="p">(),</span> <span class="n">transitions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span><span class="s1">&#39;C&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">StateMachine</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">C</span><span class="p">(),</span> <span class="n">transitions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span><span class="s1">&#39;A&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">StateMachine</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">A</span><span class="p">(),</span> <span class="n">transitions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span><span class="s1">&#39;ZERO&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="n">StateMachine</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;ZERO&#39;</span><span class="p">,</span> <span class="n">Zero</span><span class="p">(),</span> <span class="n">transitions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;success&#39;</span><span class="p">:</span><span class="s1">&#39;success&#39;</span><span class="p">})</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">sm</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>PillarTable.scene</strong>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(noname)+
</span></span><span class="line"><span class="cl">* pillar
</span></span><span class="line"><span class="cl">1
</span></span><span class="line"><span class="cl">box
</span></span><span class="line"><span class="cl">0.308 0.13056 0.6528
</span></span><span class="line"><span class="cl">0.7 -0.01 0.03
</span></span><span class="line"><span class="cl">0.0108439 0.706876 0.0103685 0.707178
</span></span><span class="line"><span class="cl">0 0 0 0
</span></span><span class="line"><span class="cl">* tabletop
</span></span><span class="line"><span class="cl">1
</span></span><span class="line"><span class="cl">box
</span></span><span class="line"><span class="cl">0.7 1.3 0.02
</span></span><span class="line"><span class="cl">0.7 0.04 -0.13
</span></span><span class="line"><span class="cl">0 0 0 1
</span></span><span class="line"><span class="cl">0.705882 0.705882 0.705882 1
</span></span><span class="line"><span class="cl">.
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/ros/">Ros</a>
        
            <a href="/tags/robotics/">Robotics</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/post/reading-notes/notes-at-school/crazyswarmusage/">
        
        

        <div class="article-details">
            <h2 class="article-title">crazyswarm功能包使用</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/post/robot-notes/wheeltech-robot/">
        
        

        <div class="article-details">
            <h2 class="article-title">轮趣R550-鲁班猫1S机器人</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/post/reading-notes/notes-at-school/cplusplus-basic/">
        
        

        <div class="article-details">
            <h2 class="article-title">c&#43;&#43;基础</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/post/reading-notes/notes-at-school/codealgorithm/">
        
        

        <div class="article-details">
            <h2 class="article-title">代码随想录 算法</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/post/reading-notes/notes-at-school/embedinterview/">
        
        

        <div class="article-details">
            <h2 class="article-title">嵌入式面试</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="raff-zeng/raff-zeng.github.io"
        issue-term="pathname"
        
        label="comment"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2024 raff
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
